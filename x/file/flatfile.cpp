// Module: Flatfile.obj
// Source: C:\Copter\Source\X\File\Flatfile.cpp
// autogenerated by simcopter_tool from PDB file

// Type: class FlatFile (forward reference);
class FlatFile{
		enum FlatFile::__unnamed {
			kMaxNameLen = 255,
		};
protected:
	class FlatFile* fNext;
	unsigned char fName[256];
	long fFileID;
	struct _iobuf* fFile;
	long UniqueID();
private:
	static class FlatFile* sList;
	static long sLastFileID;
	void Link();
	void Unlink();
	unsigned short Exclusive();
public:
	void FlatFile();
	// vtable: 0
	intro void ~FlatFile();
	// calltype: NearC
	static class FlatFile* FindByName(unsigned char *);
	unsigned short SameFile(class FlatFile*);
	// vtable: 4
	intro long Open(unsigned char *);
	// vtable: 8
	intro long Open(char *);
	// vtable: 12
	intro long Close();
	void OpenFromOtherFile(class FlatFile*);
	long GetFileName(unsigned char *);
	unsigned short ValidFile();
	long ReadBlock(void * __ptr32, long *);
	long Read4(long *);
	long Read2(short *);
	long Read1(char *);
	long SetPos(long);
	long Advance(long);
	// calltype: NearC
	static short CheckForLeaks();
	long GetFileID();
	struct _iobuf* GetFile();
};

// Type: long;

// Type: void;

// Type: unsigned char *;

// Type: char *;

// Type: unsigned char[256];

// Type: char[256];

// Type: void * __ptr32;

// Type: long *;

// Type: unsigned short;

// Type: short *;

// Type: char *;

// Type: short;

// Type: uint32_t;



// Contribution: 1:0015b270-0015bac4 Module: 195, 16 byte alignment, code, execute, read, 
// FUNCTION: COPTER_D 0x0055c270
void FlatFile::FlatFile() {

	__asm        mov    eax, this;
	__asm        mov    dword ptr [eax], 0x593620;
// LINE 14:
	__asm        mov    eax, this;
	__asm        mov    byte ptr [eax+8], 0;
// LINE 19:
	__asm        mov    eax, this;
	__asm        mov    dword ptr [eax+0x10C], 0;
// LINE 21:
	__asm        mov    eax, this;
	__asm        mov    dword ptr [eax+0x108], 0;
// LINE 22:
	__asm        mov    ecx, this;
	__asm        call   FlatFile::Link;
// LINE 23:
	__asm        jmp    near ptr 0x0055C2B3;

	__asm        mov    eax, this;
}

// FUNCTION: COPTER_D 0x0055c2bb
void FlatFile::~FlatFile() {

	__asm        mov    eax, this;
	__asm        mov    dword ptr [eax], 0x593620;
// LINE 30:
	__asm        mov    eax, this;
	__asm        cmp    dword ptr [eax+0x10C], 0;
	__asm        je     _T2d;

	__asm        mov    ecx, this;
	__asm        call   FlatFile::Close;
// LINE 32:
_T2d:
	__asm        mov    ecx, this;
	__asm        call   FlatFile::Unlink;
// LINE 33:
	__asm        jmp    near ptr 0x0055C2F5;
}

// FUNCTION: COPTER_D 0x0055c2fa
class FlatFile* FlatFile::FindByName(unsigned char * name) {
	class FlatFile* srch;

// LINE 44:
	__asm        mov    eax, FlatFile::sList;
	__asm        mov    srch, eax;
	__asm        jmp    _T1f;
_T16:
	__asm        mov    eax, srch;
	__asm        mov    eax, [eax+4];
	__asm        mov    srch, eax;
_T1f:
	__asm        cmp    srch, 0;
	__asm        je     _T64;
// LINE 46:
	__asm        mov    ecx, srch;
	__asm        call   FlatFile::ValidFile;
	__asm        movzx  eax, ax;
	__asm        test   eax, eax;
	__asm        je     _T5f;

	__asm        mov    eax, srch;
	__asm        add    eax, 8;
	__asm        push   eax;
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   PStrCompare;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T5f;

	__asm        mov    eax, srch;
	__asm        jmp    _T6b;
// LINE 47:
_T5f:
	__asm        jmp    _T16;
// LINE 48:
_T64:
	__asm        xor    eax, eax;
	__asm        jmp    _T6b;
// LINE 49:
_T6b:
}

// FUNCTION: COPTER_D 0x0055c36a
long FlatFile::Open(char * name) {
	unsigned char pstrbuff[256];

// LINE 54:
	__asm        push   0x100;
	__asm        lea    eax, pstrbuff[0];
	__asm        push   eax;
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   Memory::BlockMove;
	__asm        add    esp, 0xC;
// LINE 55:
	__asm        lea    eax, pstrbuff[0];
	__asm        push   eax;
	__asm        call   CtoPstr;
	__asm        add    esp, 4;
// LINE 56:
	__asm        lea    eax, pstrbuff[0];
	__asm        push   eax;
	__asm        mov    eax, this;
	__asm        mov    eax, [eax];
	__asm        mov    ecx, this;
	__asm        call   dword ptr [eax+4];
	__asm        jmp    near ptr 0x0055C3C0;
// LINE 57:
}

// FUNCTION: COPTER_D 0x0055c3c7
long FlatFile::Open(unsigned char * name) {
	class FlatFile* same;
	long err;

// LINE 61:
	__asm        mov    ecx, this;
	__asm        call   FlatFile::ValidFile;
	__asm        movzx  eax, ax;
	__asm        test   eax, eax;
	__asm        je     _T32;

	__asm        mov    eax, 0xFFFFFFD1;
	__asm        jmp    _T1b8;
// LINE 63:
_T32:
	__asm        mov    err, 0;
// LINE 65:
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   FlatFile::FindByName;
	__asm        add    esp, 4;
	__asm        mov    same, eax;
// LINE 67:
	__asm        cmp    same, 0;
	__asm        jne    _T142;
// LINE 73:
// Block start:
	char cstrbuff[256];
	long test;
	__asm        mov    test, 1;
	__asm        jmp    _T61;
_T5e:
	__asm        inc    test;
_T61:
	__asm        mov    eax, name;
	__asm        xor    ecx, ecx;
	__asm        mov    cl, [eax];
	__asm        cmp    ecx, test;
	__asm        jl     _Tad;
// LINE 74:
	__asm        cmp    test, 2;
	__asm        je     _Ta8;

	__asm        mov    eax, test;
	__asm        mov    ecx, name;
	__asm        xor    edx, edx;
	__asm        mov    dl, [eax+ecx];
	__asm        cmp    edx, 0x3A;
	__asm        jne    _Ta8;
// LINE 75:
	__asm        push   0x8C085;
	__asm        push   0x5BDDE0;
	__asm        push   0x4B;
	__asm        push   0x5BDDEC;
	__asm        call   doAssert;
	__asm        add    esp, 0x10;
// LINE 77:
_Ta8:
	__asm        jmp    _T5e;
// LINE 80:
_Tad:
	__asm        push   0x100;
	__asm        lea    eax, cstrbuff[0];
	__asm        push   eax;
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   Memory::BlockMove;
	__asm        add    esp, 0xC;
// LINE 81:
	__asm        lea    eax, cstrbuff[0];
	__asm        push   eax;
	__asm        call   PtoCstr;
	__asm        add    esp, 4;
// LINE 82:
	__asm        push   0x5BDE14;
	__asm        lea    eax, cstrbuff[0];
	__asm        push   eax;
	__asm        call   fopen;
	__asm        add    esp, 8;
	__asm        mov    ecx, this;
	__asm        mov    [ecx+0x10C], eax;
// LINE 83:
	__asm        mov    eax, this;
	__asm        cmp    dword ptr [eax+0x10C], 0;
	__asm        je     _T11a;

	__asm        mov    eax, this;
	__asm        cmp    dword ptr [eax+0x10C], 0xFFFFFFFF;
	__asm        jne    _T121;
_T11a:
	__asm        mov    err, 0xFFFFFFCE;
// LINE 85:
_T121:
	__asm        inc    FlatFile::sLastFileID;
	__asm        mov    eax, FlatFile::sLastFileID;
	__asm        mov    ecx, this;
	__asm        mov    [ecx+0x108], eax;
	__asm        jmp    near ptr 0x0055C504;
// LINE 87:
// Block end:
	__asm        jmp    _T16c;
// LINE 92:
_T142:
	__asm        mov    eax, same;
	__asm        mov    eax, [eax+0x10C];
	__asm        mov    ecx, this;
	__asm        mov    [ecx+0x10C], eax;
// LINE 94:
	__asm        mov    eax, same;
	__asm        mov    eax, [eax+0x108];
	__asm        mov    ecx, this;
	__asm        mov    [ecx+0x108], eax;
// LINE 97:
_T16c:
	__asm        cmp    err, 0;
	__asm        je     _T195;
// LINE 99:
	__asm        mov    eax, this;
	__asm        mov    byte ptr [eax+8], 0;
// LINE 100:
	__asm        mov    eax, this;
	__asm        mov    dword ptr [eax+0x108], 0;
// LINE 102:
	__asm        jmp    _T1b0;
// LINE 104:
_T195:
	__asm        push   0x100;
	__asm        mov    eax, this;
	__asm        add    eax, 8;
	__asm        push   eax;
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   Memory::BlockMove;
	__asm        add    esp, 0xC;
// LINE 107:
_T1b0:
	__asm        mov    eax, err;
	__asm        jmp    _T1b8;
// LINE 108:
_T1b8:
}

// FUNCTION: COPTER_D 0x0055c586
void FlatFile::OpenFromOtherFile(class FlatFile* other) {
	unsigned char otherName[256];

// LINE 112:
	__asm        lea    eax, otherName[0];
	__asm        push   eax;
	__asm        mov    ecx, other;
	__asm        call   FlatFile::GetFileName;
// LINE 113:
	__asm        lea    eax, otherName[0];
	__asm        push   eax;
	__asm        mov    eax, this;
	__asm        mov    eax, [eax];
	__asm        mov    ecx, this;
	__asm        call   dword ptr [eax+4];
// LINE 114:
	__asm        jmp    near ptr 0x0055C5C4;
}

// FUNCTION: COPTER_D 0x0055c5cb
long FlatFile::Close() {
	long err;

// LINE 118:
	__asm        mov    ecx, this;
	__asm        call   FlatFile::ValidFile;
	__asm        movzx  eax, ax;
	__asm        test   eax, eax;
	__asm        jne    _T38;

	__asm        push   0x8C085;
	__asm        push   0x5BDE18;
	__asm        push   0x76;
	__asm        push   0x5BDE34;
	__asm        call   doAssert;
	__asm        add    esp, 0x10;
// LINE 131:
_T38:
	__asm        mov    eax, this;
	__asm        cmp    dword ptr [eax+0x10C], 0;
	__asm        jne    _T54;
// LINE 132:
	__asm        mov    err, 0xFFFFFFCF;
// LINE 133:
	__asm        jmp    _Ta0;
_T54:
	__asm        mov    ecx, this;
	__asm        call   FlatFile::Exclusive;
	__asm        movzx  eax, ax;
	__asm        test   eax, eax;
	__asm        je     _T99;
// LINE 135:
	__asm        mov    eax, this;
	__asm        mov    eax, [eax+0x10C];
	__asm        push   eax;
	__asm        call   fclose;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        je     _T8d;

	__asm        mov    err, 0xFFFFFFCE;
// LINE 136:
	__asm        jmp    _T94;
_T8d:
	__asm        mov    err, 0;
// LINE 138:
_T94:
	__asm        jmp    _Ta0;
// LINE 139:
_T99:
	__asm        mov    err, 0;
// LINE 142:
_Ta0:
	__asm        cmp    err, 0;
	__asm        jne    _Tc4;
// LINE 147:
	__asm        mov    eax, this;
	__asm        mov    dword ptr [eax+0x10C], 0;
// LINE 149:
	__asm        mov    eax, this;
	__asm        mov    dword ptr [eax+0x108], 0;
// LINE 151:
_Tc4:
	__asm        mov    eax, err;
	__asm        jmp    near ptr 0x0055C697;
// LINE 152:
}

// FUNCTION: COPTER_D 0x0055c69c
long FlatFile::ReadBlock(void * __ptr32 buffer, long * blockSize) {
	long actualSize;

// LINE 159:
	__asm        mov    ecx, this;
	__asm        call   FlatFile::ValidFile;
	__asm        movzx  eax, ax;
	__asm        test   eax, eax;
	__asm        jne    _T29;

	__asm        mov    eax, 0xFFFFFFCF;
	__asm        jmp    _T6e;
// LINE 172:
_T29:
	__asm        mov    eax, this;
	__asm        mov    eax, [eax+0x10C];
	__asm        push   eax;
	__asm        mov    eax, blockSize;
	__asm        mov    eax, [eax];
	__asm        push   eax;
	__asm        push   1;
	__asm        mov    eax, buffer;
	__asm        push   eax;
	__asm        call   fread;
	__asm        add    esp, 0x10;
	__asm        mov    actualSize, eax;
// LINE 173:
	__asm        mov    eax, blockSize;
	__asm        mov    ecx, actualSize;
	__asm        cmp    [eax], ecx;
	__asm        je     _T67;

	__asm        mov    eax, 0xFFFFFFD0;
	__asm        jmp    _T6e;
// LINE 174:
	__asm        jmp    _T6e;
_T67:
	__asm        xor    eax, eax;
	__asm        jmp    _T6e;
// LINE 176:
_T6e:
}

// FUNCTION: COPTER_D 0x0055c711
long FlatFile::SetPos(long fromStart) {
// LINE 180:
	__asm        mov    ecx, this;
	__asm        call   FlatFile::ValidFile;
	__asm        movzx  eax, ax;
	__asm        test   eax, eax;
	__asm        jne    _T29;

	__asm        mov    eax, 0xFFFFFFCF;
	__asm        jmp    _T5f;
// LINE 185:
_T29:
	__asm        push   0;
	__asm        mov    eax, fromStart;
	__asm        push   eax;
	__asm        mov    eax, this;
	__asm        mov    eax, [eax+0x10C];
	__asm        push   eax;
	__asm        call   fseek;
	__asm        add    esp, 0xC;
	__asm        test   eax, eax;
	__asm        je     _T58;

	__asm        mov    eax, 0xFFFFFFCE;
	__asm        jmp    _T5f;
// LINE 186:
	__asm        jmp    _T5f;
_T58:
	__asm        xor    eax, eax;
	__asm        jmp    _T5f;
// LINE 188:
_T5f:
}

// FUNCTION: COPTER_D 0x0055c777
long FlatFile::Advance(long skipAmt) {
// LINE 192:
	__asm        mov    ecx, this;
	__asm        call   FlatFile::ValidFile;
	__asm        movzx  eax, ax;
	__asm        test   eax, eax;
	__asm        jne    _T29;

	__asm        mov    eax, 0xFFFFFFCF;
	__asm        jmp    _T5f;
// LINE 197:
_T29:
	__asm        push   1;
	__asm        mov    eax, skipAmt;
	__asm        push   eax;
	__asm        mov    eax, this;
	__asm        mov    eax, [eax+0x10C];
	__asm        push   eax;
	__asm        call   fseek;
	__asm        add    esp, 0xC;
	__asm        test   eax, eax;
	__asm        je     _T58;

	__asm        mov    eax, 0xFFFFFFCE;
	__asm        jmp    _T5f;
// LINE 198:
	__asm        jmp    _T5f;
_T58:
	__asm        xor    eax, eax;
	__asm        jmp    _T5f;
// LINE 200:
_T5f:
}

// FUNCTION: COPTER_D 0x0055c7dd
unsigned short FlatFile::ValidFile() {
// LINE 221:
	__asm        mov    eax, this;
	__asm        cmp    dword ptr [eax+0x108], 0;
	__asm        jne    _T29;

	__asm        xor    ax, ax;
	__asm        jmp    _T32;
// LINE 222:
	__asm        jmp    _T32;
_T29:
	__asm        mov    ax, 1;
	__asm        jmp    _T32;
// LINE 223:
_T32:
}

// FUNCTION: COPTER_D 0x0055c814
unsigned short FlatFile::SameFile(class FlatFile* other) {
// LINE 235:
	__asm        mov    eax, this;
	__asm        cmp    dword ptr [eax+0x108], 0;
	__asm        je     _T57;

	__asm        jmp    near ptr 0x0055C835;

	__asm        mov    eax, other;
	__asm        cmp    dword ptr [eax+0x108], 0;
	__asm        je     _T57;

	__asm        mov    eax, this;
	__asm        mov    ecx, other;
	__asm        mov    ecx, [ecx+0x108];
	__asm        cmp    [eax+0x108], ecx;
	__asm        jne    _T57;
// LINE 236:
	__asm        mov    ax, 1;
	__asm        jmp    _T5f;
// LINE 237:
	__asm        jmp    _T5f;
// LINE 238:
_T57:
	__asm        xor    ax, ax;
	__asm        jmp    _T5f;
// LINE 239:
_T5f:
}

// FUNCTION: COPTER_D 0x0055c87a
long FlatFile::Read4(long * val) {
	long err;
	long size;

// LINE 244:
	__asm        mov    size, 4;
// LINE 245:
	__asm        lea    eax, size;
	__asm        push   eax;
	__asm        mov    eax, val;
	__asm        push   eax;
	__asm        mov    ecx, this;
	__asm        call   FlatFile::ReadBlock;
	__asm        mov    err, eax;
// LINE 246:
	__asm        cmp    err, 0;
	__asm        jne    _T3c;

	__asm        mov    eax, val;
	__asm        push   eax;
	__asm        call   Swizzle4;
	__asm        add    esp, 4;
// LINE 247:
_T3c:
	__asm        mov    eax, err;
	__asm        jmp    near ptr 0x0055C8BE;
// LINE 248:
}

// FUNCTION: COPTER_D 0x0055c8c5
long FlatFile::Read2(short * val) {
	long err;
	long size;

// LINE 252:
	__asm        mov    size, 2;
// LINE 253:
	__asm        lea    eax, size;
	__asm        push   eax;
	__asm        mov    eax, val;
	__asm        push   eax;
	__asm        mov    ecx, this;
	__asm        call   FlatFile::ReadBlock;
	__asm        mov    err, eax;
// LINE 254:
	__asm        cmp    err, 0;
	__asm        jne    _T3c;

	__asm        mov    eax, val;
	__asm        push   eax;
	__asm        call   Swizzle2;
	__asm        add    esp, 4;
// LINE 255:
_T3c:
	__asm        mov    eax, err;
	__asm        jmp    near ptr 0x0055C909;
// LINE 256:
}

// FUNCTION: COPTER_D 0x0055c910
long FlatFile::Read1(char * val) {
	long err;
	long size;

// LINE 260:
	__asm        mov    size, 1;
// LINE 261:
	__asm        lea    eax, size;
	__asm        push   eax;
	__asm        mov    eax, val;
	__asm        push   eax;
	__asm        mov    ecx, this;
	__asm        call   FlatFile::ReadBlock;
	__asm        mov    err, eax;
// LINE 262:
	__asm        mov    eax, err;
	__asm        jmp    near ptr 0x0055C93E;
// LINE 263:
}

// FUNCTION: COPTER_D 0x0055c945
void FlatFile::Link() {
// LINE 266:
	__asm        mov    eax, FlatFile::sList;
	__asm        mov    ecx, this;
	__asm        mov    [ecx+4], eax;
// LINE 267:
	__asm        mov    eax, this;
	__asm        mov    FlatFile::sList, eax;
// LINE 268:
	__asm        jmp    near ptr 0x0055C969;
}

// FUNCTION: COPTER_D 0x0055c96e
void FlatFile::Unlink() {
	class FlatFile** srch;

// LINE 271:
	__asm        mov    srch, 0x5BDDD8;
// LINE 273:
_T13:
	__asm        mov    eax, srch;
	__asm        cmp    dword ptr [eax], 0;
	__asm        je     _T4f;
// LINE 274:
	__asm        mov    eax, srch;
	__asm        mov    ecx, this;
	__asm        cmp    [eax], ecx;
	__asm        jne    _T3f;
// LINE 275:
	__asm        mov    eax, srch;
	__asm        mov    eax, [eax];
	__asm        mov    eax, [eax+4];
	__asm        mov    ecx, srch;
	__asm        mov    [ecx], eax;
// LINE 276:
	__asm        jmp    _T70;
// LINE 278:
_T3f:
	__asm        mov    eax, srch;
	__asm        mov    eax, [eax];
	__asm        add    eax, 4;
	__asm        mov    srch, eax;
// LINE 279:
	__asm        jmp    _T13;
// LINE 280:
_T4f:
	__asm        push   0x8C085;
	__asm        push   0x5BDE5C;
	__asm        push   0x118;
	__asm        push   0x5BDE74;
	__asm        call   doAssert;
	__asm        add    esp, 0x10;
// LINE 281:
	__asm        jmp    _T70;
_T70:
}

// FUNCTION: COPTER_D 0x0055c9e3
unsigned short FlatFile::Exclusive() {
	class FlatFile* srch;

// LINE 285:
	__asm        mov    eax, FlatFile::sList;
	__asm        mov    srch, eax;
// LINE 286:
_T14:
	__asm        cmp    srch, 0;
	__asm        je     _T57;
// LINE 287:
	__asm        mov    eax, this;
	__asm        cmp    srch, eax;
	__asm        je     _T49;

	__asm        mov    eax, srch;
	__asm        push   eax;
	__asm        mov    ecx, this;
	__asm        call   FlatFile::SameFile;
	__asm        movzx  eax, ax;
	__asm        test   eax, eax;
	__asm        je     _T49;
// LINE 288:
	__asm        xor    ax, ax;
	__asm        jmp    _T60;
// LINE 289:
_T49:
	__asm        mov    eax, srch;
	__asm        mov    eax, [eax+4];
	__asm        mov    srch, eax;
// LINE 290:
	__asm        jmp    _T14;
// LINE 291:
_T57:
	__asm        mov    ax, 1;
	__asm        jmp    _T60;
// LINE 292:
_T60:
}

// FUNCTION: COPTER_D 0x0055ca48
long FlatFile::GetFileName(unsigned char * name) {
// LINE 296:
	__asm        mov    eax, this;
	__asm        xor    ecx, ecx;
	__asm        mov    cl, [eax+8];
	__asm        inc    ecx;
	__asm        push   ecx;
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        mov    eax, this;
	__asm        add    eax, 8;
	__asm        push   eax;
	__asm        call   Memory::BlockMove;
	__asm        add    esp, 0xC;
// LINE 297:
	__asm        xor    eax, eax;
	__asm        jmp    near ptr 0x0055CA78;
// LINE 298:
}

// FUNCTION: COPTER_D 0x0055ca7f
short FlatFile::CheckForLeaks() {
	short total;
	class FlatFile* list;

// LINE 302:
	__asm        mov    total, 0;
// LINE 304:
	__asm        mov    eax, FlatFile::sList;
	__asm        mov    list, eax;
	__asm        jmp    _T25;
_T1c:
	__asm        mov    eax, list;
	__asm        mov    eax, [eax+4];
	__asm        mov    list, eax;
_T25:
	__asm        cmp    list, 0;
	__asm        je     _T38;
// LINE 306:
	__asm        inc    total;
// LINE 307:
	__asm        jmp    _T1c;
// LINE 308:
_T38:
	__asm        mov    ax, total;
	__asm        jmp    near ptr 0x0055CAC0;
// LINE 309:
}



// Contribution: 1:0015bad0-0015bb08 Module: 195, 16 byte alignment, code, (comdat), execute, read, 
// FUNCTION: COPTER_D 0x0055cad0
// FlatFile::`scalar deleting destructor'



// Contribution: 2:00004620-0000462f Module: 195, 8 byte alignment, initialized_data, (comdat), read, 
// GLOBAL: COPTER_D 0x00593620
// GLOBAL: COPTER_D 0x00593620
// ??_7FlatFile@@6B@


// Contribution: 3:00026dd8-00026e98 Module: 195, 4 byte alignment, initialized_data, read, write, 
// GLOBAL: COPTER_D 0x005bddd8
class FlatFile* FlatFile::sList = { /* <data@0x005bddd8> */ };

// GLOBAL: COPTER_D 0x005bdddc
long FlatFile::sLastFileID = { /* <data@0x005bdddc> */ };

