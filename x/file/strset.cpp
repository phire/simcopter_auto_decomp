// Module: Strset.obj
// Source: C:\Copter\Source\X\File\Strset.cpp
// autogenerated by simcopter_tool from PDB file

// Type: class StringSet (forward reference);
class StringSet{
private:
	class ResFile *fResFile;
	long fNumStrings;
	void * __ptr32 fStringHandle;
	unsigned char * fStringPtr;
	void LoadStrings(short);
	// calltype: NearC
	static void Swizzle(void * __ptr32, long);
public:
	void StringSet(class ResFile*, short);
	void StringSet(class ResFile*, short, short);
	void ~StringSet();
	unsigned char * GetString(short);
	short Count();
};

// Type: class ResFile (forward reference);
// VTABLE: COPTER_D 0x00593518
class ResFile : public FlatResFile
{
public:
	long OpenFromOtherFile(class ResFile*);
};

// Type: short;

// Type: void;

// Type: void * __ptr32;

// Type: long;

// Type: unsigned char *;

// Type: class FlatResFile;
// VTABLE: COPTER_D 0x00593508
class FlatResFile : public FlatFile
{
protected:
	class ResMap *fMap;
	long fError;
	short _alignPad;
public:
	void FlatResFile();
	virtual void ~FlatResFile() /* override */;
	void LoadResMap(void * __ptr32*, short *, long *);
	unsigned short FileEquals(class FlatResFile*);
	virtual long Open(unsigned char *) /* override */;
	virtual long Open(char *) /* override */;
	long OpenFromName();
	virtual long Close() /* override */;
	short CountTypes();
	unsigned long GetIndType(short);
	short Count(unsigned long);
	void * __ptr32 GetByID(unsigned long, short, void (*)(void * __ptr32, long));
	void * __ptr32 GetByName(unsigned long, unsigned char *, void (*)(void * __ptr32, long));
	void * __ptr32 GetByIndex(unsigned long, short, void (*)(void * __ptr32, long));
	void GetName(void * __ptr32, unsigned char *);
	void GetID(void * __ptr32, short *);
	unsigned long GetResType(void * __ptr32);
	void Release(void * __ptr32);
	void Detach(void * __ptr32);
	void Load(void * __ptr32);
	long GetError();
	void Add(void * __ptr32, unsigned long, short, unsigned char *);
	void ExclusiveAdd(void * __ptr32, unsigned long, short, unsigned char *);
	void FindUniqueName(unsigned long, unsigned char *);
	short FindUniqueID(unsigned long);
	void Write(void * __ptr32);
	void Remove(void * __ptr32);
	void GetString(unsigned char *, short, short);
	// calltype: NearC
	static short CheckForLeaks();
};

// Type: class FlatFile;
// VTABLE: COPTER_D 0x00593620
class FlatFile{
	enum /* __unnamed */ {
		kMaxNameLen = 255,
	};
protected:
	class FlatFile *fNext;
	unsigned char fName[256];
	long fFileID;
	struct _iobuf *fFile;
	long UniqueID();
private:
	static class FlatFile *sList;
	static long sLastFileID;
	void Link();
	void Unlink();
	unsigned short Exclusive();
public:
	void FlatFile();
	virtual void ~FlatFile(); // vtable+0x0
	// calltype: NearC
	static class FlatFile* FindByName(unsigned char *);
	unsigned short SameFile(class FlatFile*);
	virtual long Open(unsigned char *); // vtable+0x4
	virtual long Open(char *); // vtable+0x8
	virtual long Close(); // vtable+0xc
	void OpenFromOtherFile(class FlatFile*);
	long GetFileName(unsigned char *);
	unsigned short ValidFile();
	long ReadBlock(void * __ptr32, long *);
	long Read4(long *);
	long Read2(short *);
	long Read1(char *);
	long SetPos(long);
	long Advance(long);
	// calltype: NearC
	static short CheckForLeaks();
	long GetFileID();
	struct _iobuf* GetFile();
};



// Contribution: 1:00164a40-00164c90 Module: 185, 16 byte alignment, code, execute, read, 
// FUNCTION: COPTER_D 0x00565a40
void StringSet::StringSet(class ResFile *file, short resID) {
// LINE 13:
	this->fResFile = file;
// LINE 15:
	__asm        mov    eax, reinterpret_cast<uint32_t>(resID);
	__asm        push   eax;
	__asm        mov    ecx, this;
	__asm        call   StringSet::LoadStrings;
// LINE 16:
	__asm        jmp    near ptr 0x00565A65;

	__asm        mov    eax, this;
}

// FUNCTION: COPTER_D 0x00565a6f
void StringSet::StringSet(class ResFile *file, short resID, short numStrings) {
// LINE 21:
	this->fResFile = file;
// LINE 23:
	__asm        mov    eax, reinterpret_cast<uint32_t>(resID);
	__asm        push   eax;
	__asm        mov    ecx, this;
	__asm        call   StringSet::LoadStrings;
// LINE 25:
	__asm        mov    eax, this;
	__asm        mov    eax, [eax+0xC];
	__asm        movsx  eax, word ptr [eax];
	__asm        movsx  ecx, numStrings;
	__asm        cmp    eax, ecx;
	__asm        je     _T4e;
// LINE 26:
	__asm        push   0x8C085;
	__asm        push   0x5BF478;
	__asm        push   0x1A;
	__asm        push   0x5BF498;
	__asm        call   doAssert;
	__asm        add    esp, 0x10;
// LINE 28:
_T4e:
	__asm        jmp    near ptr 0x00565AC2;

	__asm        mov    eax, this;
}

// FUNCTION: COPTER_D 0x00565acc
void StringSet::LoadStrings(short resID) {
// LINE 33:
	__asm        mov    eax, this;
	__asm        mov    ecx, [eax];
	__asm        call   FlatFile::ValidFile;
	__asm        movzx  eax, ax;
	__asm        test   eax, eax;
	__asm        jne    _T3a;

	__asm        push   0x8C085;
	__asm        push   0x5BF4BC;
	__asm        push   0x21;
	__asm        push   0x5BF4CC;
	__asm        call   doAssert;
	__asm        add    esp, 0x10;
// LINE 34:
_T3a:
	__asm        push   0x565BA0;
	__asm        mov    eax, reinterpret_cast<uint32_t>(resID);
	__asm        push   eax;
	__asm        push   0x53545223;
	__asm        mov    eax, this;
	__asm        mov    ecx, [eax];
	__asm        call   FlatResFile::GetByID;
	__asm        mov    ecx, this;
	__asm        mov    [ecx+8], eax;
// LINE 36:
	__asm        mov    eax, this;
	__asm        cmp    dword ptr [eax+8], 0;
	__asm        je     _Tb4;
// LINE 37:
	__asm        mov    eax, this;
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        call   Memory::Stash;
	__asm        add    esp, 4;
	__asm        mov    ecx, this;
	__asm        mov    [ecx+0xC], eax;
// LINE 39:
	__asm        mov    eax, this;
	__asm        cmp    dword ptr [eax+0xC], 0;
	__asm        jne    _Ta0;

	__asm        push   0x8C085;
	__asm        push   0x5BF4F0;
	__asm        push   0x27;
	__asm        push   0x5BF510;
	__asm        call   doAssert;
	__asm        add    esp, 0x10;
// LINE 42:
_Ta0:
	__asm        mov    eax, this;
	__asm        mov    eax, [eax+0xC];
	__asm        movsx  eax, word ptr [eax];
	__asm        mov    ecx, this;
	__asm        mov    [ecx+4], eax;
// LINE 44:
	__asm        jmp    _Tc8;
// LINE 45:
_Tb4:
	this->fStringPtr = 0x0;
// LINE 46:
	this->fNumStrings = 0x0;
// LINE 48:
_Tc8:
	__asm        jmp    near ptr 0x00565B99;
}

// FUNCTION: COPTER_D 0x00565ba0
void StringSet::Swizzle(void * __ptr32 data, long size) {
// LINE 53:
	__asm        mov    eax, data;
	__asm        push   eax;
	__asm        call   Swizzle2;
	__asm        add    esp, 4;
// LINE 54:
	__asm        jmp    near ptr 0x00565BB7;
}

// FUNCTION: COPTER_D 0x00565bbc
void StringSet::~StringSet() {
// LINE 58:
	__asm        mov    eax, this;
	__asm        cmp    dword ptr [eax+8], 0;
	__asm        je     _T39;
// LINE 59:
	__asm        mov    eax, this;
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        call   Memory::HUnlock;
	__asm        add    esp, 4;
// LINE 60:
	__asm        mov    eax, this;
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        mov    eax, this;
	__asm        mov    ecx, [eax];
	__asm        call   FlatResFile::Release;
// LINE 62:
_T39:
	__asm        jmp    near ptr 0x00565BFA;
}

// FUNCTION: COPTER_D 0x00565bff
unsigned char * StringSet::GetString(short which) {
	short cnt;
	unsigned char * str;

// LINE 66:
	__asm        mov    eax, this;
	__asm        movsx  ecx, which;
	__asm        cmp    [eax+4], ecx;
	__asm        jl     _T29;

	__asm        movsx  eax, which;
	__asm        cmp    eax, 1;
	__asm        jge    _T49;
// LINE 67:
_T29:
	__asm        push   0x8C085;
	__asm        push   0x5BF534;
	__asm        push   0x43;
	__asm        push   0x5BF54C;
	__asm        call   doAssert;
	__asm        add    esp, 0x10;
// LINE 68:
	__asm        xor    eax, eax;
	__asm        jmp    _T8b;
// LINE 74:
_T49:
	__asm        mov    ax, which;
	__asm        mov    cnt, ax;
	__asm        mov    eax, this;
	__asm        mov    eax, [eax+0xC];
	__asm        add    eax, 2;
	__asm        mov    str, eax;
	__asm        jmp    _T66;
_T62:
	__asm        dec    cnt;
_T66:
	__asm        movsx  eax, cnt;
	__asm        cmp    eax, 1;
	__asm        jle    _T83;
// LINE 75:
	__asm        mov    eax, str;
	__asm        xor    ecx, ecx;
	__asm        mov    cl, [eax];
	__asm        inc    ecx;
	__asm        add    str, ecx;
	__asm        jmp    _T62;
// LINE 76:
_T83:
	__asm        mov    eax, str;
	__asm        jmp    _T8b;
// LINE 77:
_T8b:
}



// Contribution: 3:00028478-0002856e Module: 185, 4 byte alignment, initialized_data, read, write, 
