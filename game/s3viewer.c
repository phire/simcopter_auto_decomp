// Module: S3viewer.obj
// Source: C:\Copter\source\game\S3viewer.c
// autogenerated by simcopter_tool from PDB file

// Type: long;

// Type: /*packed*/ struct Point3d;
struct Point3d{ // packed(0xc bytes) TI: 0x18b0
	/*+0x0*/   int32_t x;
	/*+0x4*/   int32_t y;
	/*+0x8*/   int32_t z;
};

// Type: int32_t;

// Type: void;



// Contribution: 1:000ed720-000ee1b4 Module: 177, 16 byte alignment, code, execute, read, 
// FUNCTION: COPTER_D 0x004ee720
void S3ViewerInit() {
	/*bp-0x40*/  int32_t rotmat[4][4]; // 0x40 bytes
	/*bp-0x4c*/  /*packed*/ struct Point3d IdealCameraLoc; // 0xc bytes

// LINE 109:
	__asm        lea    eax, IdealCameraLoc.x;
	__asm        push   eax;
	__asm        call   GetIdealCameraPos;
	__asm        add    esp, 4;
// LINE 110:
	__asm        lea    eax, IdealCameraLoc.x;
	__asm        mov    ecx, 0x6C12A0;
	__asm        add    ecx, 0x78;
	__asm        mov    edx, [eax];
	__asm        mov    [ecx], edx;
	__asm        mov    edx, [eax+4];
	__asm        mov    [ecx+4], edx;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ecx+8], eax;
// LINE 119:
	__asm        mov    eax, 0x6C12A0;
	__asm        add    eax, 0x10;
	__asm        mov    dword ptr [eax], 0;
	__asm        mov    dword ptr [eax+4], 0;
	__asm        mov    dword ptr [eax+8], 0;
	__asm        mov    dword ptr [eax+0xC], 0;
	__asm        mov    dword ptr [eax+0x10], 0;
// LINE 120:
	Viewer.p.M = 0x10000;
// LINE 121:
	Viewer.r.M = 0x10000;
// LINE 122:
	__asm        mov    eax, 0x6C12A0;
	__asm        add    eax, 0x38;
	__asm        push   eax;
	__asm        call   0x004D1FF1;
	__asm        add    esp, 4;
// LINE 123:
	Viewer.mode = 0x1;
// LINE 126:
	__asm        mov    ViewState.init_vect.y, 0;
	__asm        mov    eax, ViewState.init_vect.y;
	__asm        mov    ViewState.init_vect.x, eax;
// LINE 127:
	ViewState.init_vect.z = 0x10000;
// LINE 128:
	__asm        mov    eax, 0x6C12A0;
	__asm        add    eax, 0x78;
	__asm        mov    ecx, 0x6C1210;
	__asm        add    ecx, 0x5C;
	__asm        mov    edx, [eax];
	__asm        mov    [ecx], edx;
	__asm        mov    edx, [eax+4];
	__asm        mov    [ecx+4], edx;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ecx+8], eax;
// LINE 136:
	__asm        push   0x59B508;
	__asm        push   0xCE40000;
	__asm        lea    eax, rotmat[0][0];
	__asm        push   eax;
	__asm        call   MTArbRotMat;
	__asm        add    esp, 0xC;
// LINE 137:
	__asm        lea    eax, rotmat[0][0];
	__asm        push   eax;
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x20;
	__asm        push   eax;
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 8;
	__asm        push   eax;
	__asm        call   0x004D2094;
	__asm        add    esp, 0xC;
// LINE 138:
	__asm        push   0x59B508;
	__asm        push   0x12C0000;
	__asm        lea    eax, rotmat[0][0];
	__asm        push   eax;
	__asm        call   MTArbRotMat;
	__asm        add    esp, 0xC;
// LINE 139:
	__asm        lea    eax, rotmat[0][0];
	__asm        push   eax;
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x38;
	__asm        push   eax;
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 8;
	__asm        push   eax;
	__asm        call   0x004D2094;
	__asm        add    esp, 0xC;
// LINE 140:
	ViewState.heading = 0x0;
// LINE 141:
	ViewState.roll = 0x0;
// LINE 142:
	ViewState.pitch = 0x0;
// LINE 143:
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x20;
	__asm        mov    ecx, 0x6C1210;
	__asm        add    ecx, 0x2C;
	__asm        mov    edx, [eax];
	__asm        mov    [ecx], edx;
	__asm        mov    edx, [eax+4];
	__asm        mov    [ecx+4], edx;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ecx+8], eax;
// LINE 144:
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x38;
	__asm        mov    ecx, 0x6C1210;
	__asm        add    ecx, 0x44;
	__asm        mov    edx, [eax];
	__asm        mov    [ecx], edx;
	__asm        mov    edx, [eax+4];
	__asm        mov    [ecx+4], edx;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ecx+8], eax;
// LINE 155:
	__asm        call   S3CameraRotate;
// LINE 157:
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x5C;
	__asm        mov    ecx, 0x606EA0;
	__asm        mov    edx, [eax];
	__asm        mov    [ecx], edx;
	__asm        mov    edx, [eax+4];
	__asm        mov    [ecx+4], edx;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ecx+8], eax;
// LINE 158:
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x14;
	__asm        mov    ecx, 0x606E90;
	__asm        mov    edx, [eax];
	__asm        mov    [ecx], edx;
	__asm        mov    edx, [eax+4];
	__asm        mov    [ecx+4], edx;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ecx+8], eax;
// LINE 159:
}

// FUNCTION: COPTER_D 0x004ee8f1
void S3ViewerControl() {
	/*bp-0x4*/   long viewSize;
	/*bp-0x10*/  /*packed*/ struct Point3d vec; // 0xc bytes
	/*bp-0x14*/  long lJoystickValue;
	/*bp-0x18*/  int32_t rotx;
	/*bp-0x24*/  /*packed*/ struct Point3d IdealCameraPos; // 0xc bytes
	/*bp-0x28*/  int32_t roty;
	/*bp-0x2c*/  int32_t timerDelay;

// LINE 177:
	__asm        cmp    LoopTime, 0x200;
	__asm        jge    _T25;
// LINE 178:
	timerDelay = 0x200;
// LINE 179:
	__asm        jmp    _T2d;
// LINE 180:
_T25:
	timerDelay = LoopTime;
// LINE 183:
_T2d:
	__asm        mov    roty, 0;
	__asm        mov    eax, roty;
	__asm        mov    rotx, eax;
// LINE 186:
	__asm        push   0x26;
	__asm        call   IsEventSet;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        je     _T65;

	__asm        cmp    G_camera_mode, 3;
	__asm        je     _T65;
// LINE 187:
	rotx = 0x280000;
// LINE 188:
	__asm        jmp    _Te7;
_T65:
	__asm        push   0x27;
	__asm        call   IsEventSet;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        je     _T90;

	__asm        cmp    G_camera_mode, 3;
	__asm        je     _T90;
// LINE 189:
	rotx = 0xffd80000;
// LINE 190:
	__asm        jmp    _Te7;
// LINE 191:
_T90:
	__asm        push   0x27;
	__asm        push   0x26;
	__asm        call   GetJoystickValueEither;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        je     _Tbd;

	__asm        cmp    G_camera_mode, 3;
	__asm        je     _Tbd;

	__asm        mov    lJoystickValue, 1;
	__asm        jmp    _Tc4;
_Tbd:
	lJoystickValue = 0x0;
_Tc4:
	__asm        cmp    lJoystickValue, 0;
	__asm        je     _Te7;
// LINE 193:
	__asm        jle    _Te0;
// LINE 194:
	rotx = 0x280000;
// LINE 195:
	__asm        jmp    _Te7;
// LINE 196:
_Te0:
	rotx = 0xffd80000;
// LINE 199:
_Te7:
	__asm        push   0x28;
	__asm        call   IsEventSet;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        je     _T112;

	__asm        cmp    G_camera_mode, 3;
	__asm        je     _T112;
// LINE 200:
	roty = 0x280000;
// LINE 201:
	__asm        jmp    _T194;
_T112:
	__asm        push   0x29;
	__asm        call   IsEventSet;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        je     _T13d;

	__asm        cmp    G_camera_mode, 3;
	__asm        je     _T13d;
// LINE 202:
	roty = 0xffd80000;
// LINE 203:
	__asm        jmp    _T194;
// LINE 204:
_T13d:
	__asm        push   0x29;
	__asm        push   0x28;
	__asm        call   GetJoystickValueEither;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        je     _T16a;

	__asm        cmp    G_camera_mode, 3;
	__asm        je     _T16a;

	__asm        mov    lJoystickValue, 1;
	__asm        jmp    _T171;
_T16a:
	lJoystickValue = 0x0;
_T171:
	__asm        cmp    lJoystickValue, 0;
	__asm        je     _T194;
// LINE 206:
	__asm        jle    _T18d;
// LINE 207:
	roty = 0x280000;
// LINE 208:
	__asm        jmp    _T194;
// LINE 209:
_T18d:
	roty = 0xffd80000;
// LINE 212:
_T194:
	__asm        cmp    rotx, 0;
	__asm        jne    _T1a8;

	__asm        cmp    roty, 0;
	__asm        je     _T1b8;
// LINE 213:
_T1a8:
	__asm        mov    eax, roty;
	__asm        push   eax;
	__asm        mov    eax, rotx;
	__asm        push   eax;
	__asm        call   S3HeliRotateSpotLite;
	__asm        add    esp, 8;
// LINE 223:
_T1b8:
	__asm        lea    eax, IdealCameraPos.x;
	__asm        push   eax;
	__asm        call   GetIdealCameraPos;
	__asm        add    esp, 4;
// LINE 225:
	__asm        lea    eax, IdealCameraPos.x;
	__asm        push   eax;
	__asm        call   S3CameraMove;
	__asm        add    esp, 4;
// LINE 227:
	__asm        call   S3CameraRotate;
// LINE 230:
	__asm        push   0x6C1370;
	__asm        mov    eax, 0x6C12A0;
	__asm        add    eax, 0x38;
	__asm        push   eax;
	__asm        call   0x004D8C2E;
	__asm        add    esp, 8;
// LINE 234:
	__asm        mov    eax, 0x6C12A0;
	__asm        add    eax, 0x78;
	__asm        mov    ecx, 0x6C1210;
	__asm        add    ecx, 0x5C;
	__asm        mov    edx, [eax];
	__asm        mov    [ecx], edx;
	__asm        mov    edx, [eax+4];
	__asm        mov    [ecx+4], edx;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ecx+8], eax;
// LINE 237:
	__asm        mov    eax, ViewState.world_pos.x;
	__asm        add    eax, 0x20000000;
	__asm        sar    eax, 0x16;
	__asm        mov    CameraCell.x, eax;
// LINE 238:
	__asm        mov    eax, 0x20000000;
	__asm        sub    eax, ViewState.world_pos.z;
	__asm        sar    eax, 0x16;
	__asm        mov    CameraCell.y, eax;
// LINE 242:
	__asm        push   0x6C1370;
	__asm        mov    eax, 0x6C12A0;
	__asm        add    eax, 4;
	__asm        push   eax;
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 8;
	__asm        push   eax;
	__asm        call   0x004D2094;
	__asm        add    esp, 0xC;
// LINE 243:
	__asm        push   0x6C1370;
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x2C;
	__asm        push   eax;
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x20;
	__asm        push   eax;
	__asm        call   0x004D2094;
	__asm        add    esp, 0xC;
// LINE 244:
	__asm        push   0x6C1370;
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x44;
	__asm        push   eax;
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x38;
	__asm        push   eax;
	__asm        call   0x004D2094;
	__asm        add    esp, 0xC;
// LINE 245:
	__asm        mov    eax, 0x6C12A0;
	__asm        add    eax, 4;
	__asm        mov    ecx, 0x6C1210;
	__asm        add    ecx, 0x14;
	__asm        mov    edx, [eax];
	__asm        mov    [ecx], edx;
	__asm        mov    edx, [eax+4];
	__asm        mov    [ecx+4], edx;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ecx+8], eax;
// LINE 246:
	ViewState.view_vect.y = 0x0;
// LINE 247:
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x14;
	__asm        push   eax;
	__asm        call   MTNormalize;
	__asm        add    esp, 4;
// LINE 248:
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x14;
	__asm        push   eax;
	__asm        push   0x6C1330;
	__asm        call   MTCreateDOF4x4;
	__asm        add    esp, 8;
// LINE 251:
	__asm        mov    eax, ViewState.world_pos.x;
	__asm        sub    eax, S_last_viewpos.x;
	__asm        mov    vec.x, eax;
// LINE 252:
	__asm        mov    eax, ViewState.world_pos.y;
	__asm        sub    eax, S_last_viewpos.y;
	__asm        mov    vec.y, eax;
// LINE 253:
	__asm        mov    eax, ViewState.world_pos.z;
	__asm        sub    eax, S_last_viewpos.z;
	__asm        mov    vec.z, eax;
// LINE 254:
	__asm        lea    eax, vec.x;
	__asm        push   eax;
	__asm        call   MTNormalize;
	__asm        add    esp, 4;
	__asm        mov    S_posdelta, eax;
// LINE 257:
	__asm        mov    eax, S_last_viewvect.z;
	__asm        push   eax;
	__asm        mov    eax, ViewState.view_vect.z;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    ebx, eax;
	__asm        mov    eax, S_last_viewvect.x;
	__asm        push   eax;
	__asm        mov    eax, ViewState.view_vect.x;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    eax, ebx;
	__asm        cdq;
	__asm        xor    eax, edx;
	__asm        sub    eax, edx;
	__asm        mov    S_rotdelta, eax;
// LINE 258:
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x5C;
	__asm        mov    ecx, 0x606EA0;
	__asm        mov    edx, [eax];
	__asm        mov    [ecx], edx;
	__asm        mov    edx, [eax+4];
	__asm        mov    [ecx+4], edx;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ecx+8], eax;
// LINE 259:
	__asm        mov    eax, 0x6C1210;
	__asm        add    eax, 0x14;
	__asm        mov    ecx, 0x606E90;
	__asm        mov    edx, [eax];
	__asm        mov    [ecx], edx;
	__asm        mov    edx, [eax+4];
	__asm        mov    [ecx+4], edx;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ecx+8], eax;
// LINE 265:
	__asm        call   S3ViewerSetView;
// LINE 267:
	__asm        push   0x2C;
	__asm        call   IsEventSet;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        je     _T3f4;
// LINE 268:
	viewSize = G_ViewSize;
// LINE 269:
	__asm        mov    eax, viewSize;
	__asm        add    eax, 2;
	__asm        push   eax;
	__asm        call   VRInitGridObj;
	__asm        add    esp, 4;
// LINE 270:
	__asm        mov    eax, G_ViewSize;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        sub    eax, 3;
	__asm        shl    eax, 0x16;
	__asm        push   eax;
	__asm        call   VRSetBackPlane;
	__asm        add    esp, 4;
// LINE 272:
	__asm        mov    eax, viewSize;
	__asm        add    eax, 2;
	__asm        cmp    eax, G_ViewSize;
	__asm        jne    _T3ef;
// LINE 273:
	__asm        dec    G_grid_ulc.x;
// LINE 274:
	__asm        dec    G_grid_ulc.y;
// LINE 277:
_T3ef:
	__asm        jmp    _T51c;
_T3f4:
	__asm        push   0x2B;
	__asm        call   IsEventSet;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        je     _T45a;
// LINE 278:
	viewSize = G_ViewSize;
// LINE 279:
	__asm        mov    eax, viewSize;
	__asm        sub    eax, 2;
	__asm        push   eax;
	__asm        call   VRInitGridObj;
	__asm        add    esp, 4;
// LINE 280:
	__asm        mov    eax, G_ViewSize;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        sub    eax, 3;
	__asm        shl    eax, 0x16;
	__asm        push   eax;
	__asm        call   VRSetBackPlane;
	__asm        add    esp, 4;
// LINE 281:
	__asm        mov    eax, viewSize;
	__asm        sub    eax, 2;
	__asm        cmp    eax, G_ViewSize;
	__asm        jne    _T455;
// LINE 282:
	__asm        inc    G_grid_ulc.x;
// LINE 283:
	__asm        inc    G_grid_ulc.y;
// LINE 286:
_T455:
	__asm        jmp    _T51c;
_T45a:
	__asm        push   0x2B;
	__asm        push   0x2C;
	__asm        call   GetJoystickValueEither;
	__asm        add    esp, 8;
	__asm        mov    lJoystickValue, eax;
	__asm        cmp    lJoystickValue, 0;
	__asm        je     _T51c;
// LINE 287:
	__asm        jle    _T4cd;
// LINE 288:
	viewSize = G_ViewSize;
// LINE 289:
	__asm        mov    eax, viewSize;
	__asm        add    eax, 2;
	__asm        push   eax;
	__asm        call   VRInitGridObj;
	__asm        add    esp, 4;
// LINE 290:
	__asm        mov    eax, G_ViewSize;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        sub    eax, 3;
	__asm        shl    eax, 0x16;
	__asm        push   eax;
	__asm        call   VRSetBackPlane;
	__asm        add    esp, 4;
// LINE 292:
	__asm        mov    eax, viewSize;
	__asm        add    eax, 2;
	__asm        cmp    eax, G_ViewSize;
	__asm        jne    _T4c8;
// LINE 293:
	__asm        dec    G_grid_ulc.x;
// LINE 294:
	__asm        dec    G_grid_ulc.y;
// LINE 297:
_T4c8:
	__asm        jmp    _T51c;
// LINE 298:
_T4cd:
	viewSize = G_ViewSize;
// LINE 299:
	__asm        mov    eax, viewSize;
	__asm        sub    eax, 2;
	__asm        push   eax;
	__asm        call   VRInitGridObj;
	__asm        add    esp, 4;
// LINE 300:
	__asm        mov    eax, G_ViewSize;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        sub    eax, 3;
	__asm        shl    eax, 0x16;
	__asm        push   eax;
	__asm        call   VRSetBackPlane;
	__asm        add    esp, 4;
// LINE 301:
	__asm        mov    eax, viewSize;
	__asm        sub    eax, 2;
	__asm        cmp    eax, G_ViewSize;
	__asm        jne    _T51c;
// LINE 302:
	__asm        inc    G_grid_ulc.x;
// LINE 303:
	__asm        inc    G_grid_ulc.y;
// LINE 307:
_T51c:
}

// FUNCTION: COPTER_D 0x004eee12
void S3SetBackPlaneBasedOnValue(long lValue) {
	/*bp-0x4*/   long nConvertedValue;
	/*bp-0x8*/   long nOriginalViewSize;

// LINE 323:
	nOriginalViewSize = G_ViewSize;
// LINE 325:
	__asm        cmp    lValue, 0;
	__asm        jge    _T22;
// LINE 326:
	lValue = 0x0;
// LINE 327:
_T22:
	__asm        cmp    lValue, 0x64;
	__asm        jle    _T33;
// LINE 328:
	lValue = 0x64;
// LINE 329:
_T33:
	__asm        mov    eax, lValue;
	__asm        push   eax;
	__asm        call   ConvertGUIBackPlaneValueToRender;
	__asm        add    esp, 4;
	__asm        mov    nConvertedValue, eax;
// LINE 332:
	__asm        mov    eax, nConvertedValue;
	__asm        push   eax;
	__asm        call   VRInitGridObj;
	__asm        add    esp, 4;
// LINE 333:
	__asm        mov    eax, G_ViewSize;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        sub    eax, 3;
	__asm        shl    eax, 0x16;
	__asm        push   eax;
	__asm        call   VRSetBackPlane;
	__asm        add    esp, 4;
// LINE 335:
	__asm        mov    eax, G_ViewSize;
	__asm        cmp    nConvertedValue, eax;
	__asm        jne    _Ta0;
// LINE 337:
	__asm        mov    eax, nOriginalViewSize;
	__asm        sub    eax, G_ViewSize;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        add    G_grid_ulc.x, eax;
// LINE 338:
	__asm        mov    eax, nOriginalViewSize;
	__asm        sub    eax, G_ViewSize;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        add    G_grid_ulc.y, eax;
// LINE 340:
_Ta0:
}

// FUNCTION: COPTER_D 0x004eeeb7
long GetRenderBackPlaneValue() {
// LINE 349:
	__asm        mov    eax, G_ViewSize;
	__asm        jmp    near ptr 0x004EEEC7;
// LINE 350:
}

// FUNCTION: COPTER_D 0x004eeecc
long ConvertGUIBackPlaneValueToRender(long lValue) {
	/*bp-0x4*/   long lHalfOfGOBJRange;

// LINE 361:
	lHalfOfGOBJRange = 0x18;
// LINE 364:
	__asm        mov    eax, lHalfOfGOBJRange;
	__asm        imul   eax, lValue;
	__asm        mov    lValue, eax;
// LINE 365:
	__asm        mov    ecx, 0x64;
	__asm        mov    eax, lValue;
	__asm        cdq;
	__asm        idiv   ecx;
	__asm        mov    lValue, eax;
// LINE 366:
	__asm        shl    lValue, 1;
// LINE 367:
	__asm        add    lValue, 0xD;
// LINE 368:
	__asm        mov    eax, lValue;
	__asm        jmp    near ptr 0x004EEF04;
// LINE 369:
}

// FUNCTION: COPTER_D 0x004eef09
long ConvertRenderBackPlaneValueToGUI(long lValue) {
	/*bp-0x4*/   long lHalfOfGOBJRange;

// LINE 380:
	lHalfOfGOBJRange = 0x18;
// LINE 382:
	__asm        sub    lValue, 0xD;
// LINE 383:
	__asm        mov    eax, lValue;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        mov    lValue, eax;
// LINE 384:
	__asm        mov    eax, lValue;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    lValue, eax;
// LINE 385:
	__asm        mov    eax, lValue;
	__asm        cdq;
	__asm        idiv   lHalfOfGOBJRange;
	__asm        mov    lValue, eax;
// LINE 387:
	__asm        mov    eax, lValue;
	__asm        jmp    near ptr 0x004EEF4A;
// LINE 388:
}

// FUNCTION: COPTER_D 0x004eef4f
int32_t S3ViewerRotDelta() {
// LINE 401:
	__asm        mov    eax, 0x10000;
	__asm        sub    eax, S_rotdelta;
	__asm        jmp    near ptr 0x004EEF65;
// LINE 402:
}

// FUNCTION: COPTER_D 0x004eef6a
int32_t S3ViewerPosDelta() {
// LINE 412:
	__asm        mov    eax, S_posdelta;
	__asm        jmp    near ptr 0x004EEF7A;
// LINE 413:
}

// FUNCTION: COPTER_D 0x004eef7f
void S3ViewerSetView() {
	/*bp-0xc*/   /*packed*/ struct Point3d p; // 0xc bytes
	/*bp-0x4c*/  int32_t matrix[4][4]; // 0x40 bytes

// LINE 427:
	__asm        mov    eax, Viewer.pos.x;
	__asm        neg    eax;
	__asm        mov    p.x, eax;
// LINE 428:
	__asm        mov    eax, Viewer.pos.y;
	__asm        neg    eax;
	__asm        mov    p.y, eax;
// LINE 429:
	__asm        mov    eax, Viewer.pos.z;
	__asm        neg    eax;
	__asm        mov    p.z, eax;
// LINE 430:
	__asm        lea    eax, p.x;
	__asm        push   eax;
	__asm        lea    eax, matrix[0][0];
	__asm        push   eax;
	__asm        mov    eax, 0x6C12A0;
	__asm        add    eax, 0x38;
	__asm        push   eax;
	__asm        call   0x004D8B90;
	__asm        add    esp, 0xC;
// LINE 431:
	__asm        lea    eax, matrix[0][0];
	__asm        push   eax;
	__asm        mov    eax, 0x6C12A0;
	__asm        add    eax, 0x78;
	__asm        push   eax;
	__asm        call   0x004D6A12;
	__asm        add    esp, 8;
// LINE 432:
}

// FUNCTION: COPTER_D 0x004eefd9
void S3ViewerCommand(int32_t nCommand) {
// LINE 445:
	__asm        cmp    nCommand, 0x1B;
	__asm        jl     _T2b;

	__asm        cmp    nCommand, 0x20;
	__asm        jg     _T2b;
// LINE 447:
	__asm        mov    eax, nCommand;
	__asm        push   eax;
	__asm        call   S3CameraChaseAdjust;
	__asm        add    esp, 4;
// LINE 449:
	__asm        jmp    _T16d;
_T2b:
	__asm        cmp    nCommand, 0x2D;
	__asm        jne    _T41;
// LINE 450:
	__asm        xor    G_texobjs, 1;
// LINE 451:
	__asm        jmp    _T16d;
_T41:
	__asm        cmp    nCommand, 0x2E;
	__asm        jne    _T57;
// LINE 452:
	__asm        xor    G_texterr, 1;
// LINE 453:
	__asm        jmp    _T16d;
_T57:
	__asm        cmp    nCommand, 5;
	__asm        jne    _T78;
// LINE 455:
	__asm        cmp    G_camera_mode, 0;
	__asm        jne    _T73;
// LINE 456:
	__asm        call   S3CameraCycleChase;
// LINE 458:
_T73:
	__asm        jmp    _T16d;
_T78:
	__asm        cmp    nCommand, 4;
	__asm        jne    _T8c;
// LINE 459:
	__asm        call   S3MissionSetCurrNext;
// LINE 460:
	__asm        jmp    _T16d;
_T8c:
	__asm        cmp    nCommand, 0x2F;
	__asm        jne    _Taf;
// LINE 461:
	__asm        cmp    G_daynight, 1;
	__asm        sbb    eax, eax;
	__asm        neg    eax;
	__asm        push   eax;
	__asm        call   S3SetDayNight;
	__asm        add    esp, 4;
// LINE 462:
	__asm        jmp    _T16d;
_Taf:
	__asm        cmp    nCommand, 0x14;
	__asm        jne    _T16d;

	__asm        cmp    G_camera_mode, 3;
	__asm        je     _T16d;
// LINE 464:
	__asm        cmp    G_camera_mode, 2;
	__asm        jne    _Te2;
// LINE 465:
	G_camera_mode = 0x0;
// LINE 466:
	__asm        jmp    _T16d;
_Te2:
	__asm        cmp    G_camera_mode, 0;
	__asm        jne    _T13d;
// LINE 468:
	__asm        push   1;
	__asm        mov    eax, G_uheli;
	__asm        mov    eax, [eax+0xA4];
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        call   0x004D6970;
	__asm        add    esp, 8;
// LINE 469:
	__asm        cmp    G_artmode, 1;
	__asm        jne    _T12e;
// LINE 470:
	__asm        push   1;
	__asm        mov    eax, G_uheli;
	__asm        mov    eax, [eax+0xAC];
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        call   0x004D6970;
	__asm        add    esp, 8;
// LINE 471:
_T12e:
	G_camera_mode = 0x1;
// LINE 473:
	__asm        jmp    _T16d;
_T13d:
	__asm        cmp    G_camera_mode, 1;
	__asm        jne    _T16d;
// LINE 475:
	__asm        push   0;
	__asm        mov    eax, G_uheli;
	__asm        mov    eax, [eax+0xA4];
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        call   0x004D6970;
	__asm        add    esp, 8;
// LINE 476:
	G_camera_mode = 0x2;
// LINE 481:
_T16d:
}

// FUNCTION: COPTER_D 0x004ef14b
void S3SetDayNight(int32_t nDayOrNight) {
// LINE 489:
	G_daynight = nDayOrNight;
// LINE 490:
	__asm        cmp    G_VRAppInitCalled, 0;
	__asm        je     _T65;
// LINE 492:
	__asm        call   S3ObjSetFlatShading;
// LINE 493:
	__asm        cmp    G_daynight, 1;
	__asm        jne    _T3c;
// LINE 494:
	__asm        push   1;
	__asm        call   AutoSetAllHeadlights;
	__asm        add    esp, 4;
// LINE 495:
	__asm        jmp    _T46;
// LINE 496:
_T3c:
	__asm        push   0;
	__asm        call   AutoSetAllHeadlights;
	__asm        add    esp, 4;
// LINE 497:
_T46:
	__asm        mov    eax, G_ViewSize;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        sub    eax, 3;
	__asm        shl    eax, 0x16;
	__asm        push   eax;
	__asm        call   VRSetBackPlane;
	__asm        add    esp, 4;
// LINE 498:
	__asm        call   S3SwitchToProperSkyType;
// LINE 500:
_T65:
}



// Contribution: 3:0001d898-0001d8bb Module: 177, 4 byte alignment, initialized_data, read, write, 
// GLOBAL: COPTER_D 0x005b4898
int32_t thetaspeed = 327680;

// GLOBAL: COPTER_D 0x005b489c
int32_t phispeed = 327680;

// GLOBAL: COPTER_D 0x005b48a0
int32_t radius = 524288;

// GLOBAL: COPTER_D 0x005b48a4
int32_t circley = 262144;

// GLOBAL: COPTER_D 0x005b48a8
int32_t yposcilate = 131072;

// GLOBAL: COPTER_D 0x005b48ac
int32_t ynoscilate = 131072;

// GLOBAL: COPTER_D 0x005b48b0
int32_t S_hover_ht = 3276800;

// GLOBAL: COPTER_D 0x005b48b4
int32_t build_insert = 1;

// GLOBAL: COPTER_D 0x005b48b8
long G_zoom_level = 0;



// Contribution: 3:0006fe88-0006feab Module: 177, 8 byte alignment, uninitialized_data, read, write, 
// GLOBAL: COPTER_D 0x00606e88
static int32_t S_rotdelta;

// GLOBAL: COPTER_D 0x00606e8c
static int32_t S_posdelta;

// GLOBAL: COPTER_D 0x00606e90
static /*packed*/ struct Point3d S_last_viewvect;

// GLOBAL: COPTER_D 0x00606ea0
static /*packed*/ struct Point3d S_last_viewpos;



// Unknown globals:
// The PDB was slightly corrupted and we aren't sure which file these globals belong to.

// WARNING: this global might actually belong to: gridrend.asm
// GLOBAL: COPTER_D 0x00662870
long GridNSortFaces; // Contrib missing


// WARNING: this global might actually belong to: gridrend.asm
// GLOBAL: COPTER_D 0x00666390
long GridNSortCells; // Contrib missing


// WARNING: this global might actually belong to: gridrend.asm
// GLOBAL: COPTER_D 0x006663a0
long G_ViewSize; // Contrib missing


// WARNING: this global might actually belong to: gridrend.asm
// GLOBAL: COPTER_D 0x0066282c
long G_gdpolys; // Contrib missing


// WARNING: this global might actually belong to: gridrend.asm
// GLOBAL: COPTER_D 0x0066635c
long G_opolys; // Contrib missing


// WARNING: this global might actually belong to: gridrend.asm
// GLOBAL: COPTER_D 0x0066636c
long G_odpolys; // Contrib missing

// GLOBAL: COPTER_D 0x006c1328
int32_t rFriction; // Contrib missing

// GLOBAL: COPTER_D 0x006c1324
int32_t theta; // Contrib missing

// GLOBAL: COPTER_D 0x006c129c
int32_t tVmax; // Contrib missing

// GLOBAL: COPTER_D 0x006c1298
int32_t tFrictionGnd; // Contrib missing

// GLOBAL: COPTER_D 0x006c1294
int32_t tForce; // Contrib missing

// GLOBAL: COPTER_D 0x006c1290
int32_t tFrictionAir; // Contrib missing

// GLOBAL: COPTER_D 0x006c128c
int32_t rForce; // Contrib missing

// GLOBAL: COPTER_D 0x006c1288
int32_t phi; // Contrib missing

// GLOBAL: COPTER_D 0x006c1284
int32_t rVmax; // Contrib missing


// WARNING: this global might actually belong to: C:\Copter\Source\Game\s3msnlog.cpp
// GLOBAL: COPTER_D 0x006c1324
int32_t theta; // Contrib missing


// WARNING: this global might actually belong to: C:\Copter\Source\Game\s3msnlog.cpp
// GLOBAL: COPTER_D 0x006c1288
int32_t phi; // Contrib missing

// GLOBAL: COPTER_D 0x006c1328
int32_t rFriction; // Contrib missing

// GLOBAL: COPTER_D 0x006c128c
int32_t rForce; // Contrib missing

// GLOBAL: COPTER_D 0x006c1284
int32_t rVmax; // Contrib missing

// GLOBAL: COPTER_D 0x006c1290
int32_t tFrictionAir; // Contrib missing

// GLOBAL: COPTER_D 0x006c1298
int32_t tFrictionGnd; // Contrib missing

// GLOBAL: COPTER_D 0x006c1294
int32_t tForce; // Contrib missing

// GLOBAL: COPTER_D 0x006c129c
int32_t tVmax; // Contrib missing

