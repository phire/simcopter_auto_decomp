// Module: S3pssngr.obj
// Source: C:\Copter\Source\Game\S3pssngr.c
// autogenerated by simcopter_tool from PDB file

// Type: /*packed*/ struct tagHeliPassengerData (forward reference);
struct tagHeliPassengerData{ // packed(0x15c bytes) TI: 0x2a7a
	long lPassengerDataChanged;
	long lSeatsTotal;
	long lSeatsUsed;
	long lDoubleSeatsTotal;
	long lDoubleSeatsUsed;
	long lRowWidth;
	long lPassengerCount;
	/*packed*/ struct tagPassengerInfo passengers[16];
};

// Type: int32_t;

// Type: void;

// Type: long;

// Type: /*packed*/ struct tagPassengerInfo (forward reference);
struct tagPassengerInfo{ // packed(0x14 bytes) TI: 0x2a6e
	long lPassengerFace;
	long lPassengerExpression;
	long lPassengerHealth;
	long lPassengerID;
	long lPassengerSeatUsed;
};

// Type: int32_t *;



// Contribution: 1:000f8bc0-000f9082 Module: 174, 16 byte alignment, code, execute, read, 
// FUNCTION: COPTER_D 0x004f9bc0
int32_t HeliPassengerHasChanged(/*packed*/ struct tagHeliPassengerData *heliPassengerData) {
// LINE 30:
	__asm        mov    eax, heliPassengerData;
	__asm        mov    eax, [eax];
	__asm        jmp    near ptr 0x004F9BD0;
// LINE 31:
}

// FUNCTION: COPTER_D 0x004f9bd5
void HeliPassengerSetChanged(/*packed*/ struct tagHeliPassengerData *heliPassengerData) {
// LINE 38:
	heliPassengerData->lPassengerDataChanged = 0x1;
// LINE 39:
}

// FUNCTION: COPTER_D 0x004f9be9
void HeliPassengerClearChanged(/*packed*/ struct tagHeliPassengerData *heliPassengerData) {
// LINE 46:
	heliPassengerData->lPassengerDataChanged = 0x0;
// LINE 47:
}

// FUNCTION: COPTER_D 0x004f9bfd
void HeliPassengerInit(/*packed*/ struct tagHeliPassengerData *heliPassengerData, int32_t nHeliType) {
	long lSeatsTotal;
	long lRowWidth;
	int32_t i;

// LINE 59:
	heliPassengerData->lPassengerDataChanged = 0x0;
// LINE 60:
	heliPassengerData->lSeatsUsed = 0x0;
// LINE 61:
	heliPassengerData->lDoubleSeatsUsed = 0x0;
// LINE 62:
	heliPassengerData->lPassengerCount = 0x0;
// LINE 63:
	__asm        mov    eax, nHeliType;
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*4];
	__asm        lea    eax, [ecx+eax*2];
	__asm        mov    eax, S_helitype_data[0].max_seats[eax*8];
	__asm        mov    lSeatsTotal, eax;
	__asm        mov    eax, lSeatsTotal;
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    [ecx+4], eax;
// LINE 64:
	__asm        mov    lRowWidth, 5;
	__asm        mov    eax, lRowWidth;
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    [ecx+0x14], eax;
// LINE 73:
	__asm        mov    eax, lSeatsTotal;
	__asm        cdq;
	__asm        idiv   lRowWidth;
	__asm        mov    ecx, eax;
	__asm        mov    eax, lRowWidth;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        imul   ecx, eax;
	__asm        mov    eax, lSeatsTotal;
	__asm        cdq;
	__asm        idiv   lRowWidth;
	__asm        mov    eax, edx;
	__asm        cdq;
	__asm        sub    eax, edx;
	__asm        sar    eax, 1;
	__asm        add    ecx, eax;
	__asm        mov    eax, heliPassengerData;
	__asm        mov    [eax+0xC], ecx;
// LINE 76:
	__asm        mov    i, 0;
	__asm        jmp    _T99;
_T96:
	__asm        inc    i;
_T99:
	__asm        cmp    i, 0x10;
	__asm        jge    _Tf8;
// LINE 77:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    dword ptr [eax+ecx+0x1C], 0xFFFFFFFF;
// LINE 78:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    dword ptr [eax+ecx+0x20], 0;
// LINE 79:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    dword ptr [eax+ecx+0x24], 0;
// LINE 80:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    dword ptr [eax+ecx+0x28], 0xFFFFFFFF;
// LINE 81:
	__asm        jmp    _T96;
// LINE 82:
_Tf8:
}

// FUNCTION: COPTER_D 0x004f9cfa
int32_t HeliPassengerCanAdd(/*packed*/ struct tagHeliPassengerData *heliPassengerData, /*packed*/ struct tagPassengerInfo *passenger) {
// LINE 95:
	__asm        mov    eax, heliPassengerData;
	__asm        mov    eax, [eax+4];
	__asm        mov    ecx, heliPassengerData;
	__asm        sub    eax, [ecx+8];
	__asm        jmp    near ptr 0x004F9D11;
// LINE 96:
}

// FUNCTION: COPTER_D 0x004f9d16
int32_t HeliPassengerAdd(/*packed*/ struct tagHeliPassengerData *heliPassengerData, /*packed*/ struct tagPassengerInfo *passenger) {
	int32_t i;

// LINE 111:
	__asm        mov    eax, passenger;
	__asm        push   eax;
	__asm        mov    eax, heliPassengerData;
	__asm        push   eax;
	__asm        call   HeliPassengerCanAdd;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T28;
// LINE 112:
	__asm        xor    eax, eax;
	__asm        jmp    _Te9;
// LINE 114:
_T28:
	__asm        mov    i, 0;
	__asm        jmp    _T37;
_T34:
	__asm        inc    i;
_T37:
	__asm        cmp    i, 0x10;
	__asm        jge    _Te2;
// LINE 116:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        cmp    dword ptr [eax+ecx+0x1C], 0xFFFFFFFF;
	__asm        jne    _Tdd;
// LINE 117:
	__asm        mov    eax, passenger;
	__asm        mov    eax, [eax];
	__asm        mov    ecx, i;
	__asm        shl    ecx, 2;
	__asm        lea    ecx, [ecx+ecx*4];
	__asm        mov    edx, heliPassengerData;
	__asm        mov    [ecx+edx+0x1C], eax;
// LINE 118:
	__asm        mov    eax, passenger;
	__asm        mov    eax, [eax+4];
	__asm        mov    ecx, i;
	__asm        shl    ecx, 2;
	__asm        lea    ecx, [ecx+ecx*4];
	__asm        mov    edx, heliPassengerData;
	__asm        mov    [ecx+edx+0x20], eax;
// LINE 119:
	__asm        mov    eax, passenger;
	__asm        mov    eax, [eax+8];
	__asm        mov    ecx, i;
	__asm        shl    ecx, 2;
	__asm        lea    ecx, [ecx+ecx*4];
	__asm        mov    edx, heliPassengerData;
	__asm        mov    [ecx+edx+0x24], eax;
// LINE 120:
	__asm        mov    eax, passenger;
	__asm        mov    eax, [eax+0xC];
	__asm        mov    ecx, i;
	__asm        shl    ecx, 2;
	__asm        lea    ecx, [ecx+ecx*4];
	__asm        mov    edx, heliPassengerData;
	__asm        mov    [ecx+edx+0x28], eax;
// LINE 121:
	__asm        mov    eax, heliPassengerData;
	__asm        inc    dword ptr [eax+8];
// LINE 122:
	__asm        mov    eax, heliPassengerData;
	__asm        inc    dword ptr [eax+0x18];
// LINE 125:
	__asm        mov    eax, heliPassengerData;
	__asm        push   eax;
	__asm        call   HeliPassengerFitToSeats;
	__asm        add    esp, 4;
// LINE 126:
	__asm        mov    eax, heliPassengerData;
	__asm        push   eax;
	__asm        call   HeliPassengerSetChanged;
	__asm        add    esp, 4;
// LINE 130:
	__asm        mov    eax, 1;
	__asm        jmp    _Te9;
// LINE 132:
_Tdd:
	__asm        jmp    _T34;
// LINE 135:
_Te2:
	__asm        xor    eax, eax;
	__asm        jmp    _Te9;
// LINE 136:
_Te9:
}

// FUNCTION: COPTER_D 0x004f9e04
int32_t HeliPassengerGetIndexInHeli(/*packed*/ struct tagHeliPassengerData *heliPassengerData, long id) {
	int32_t i;

// LINE 147:
	__asm        mov    i, 0;
	__asm        jmp    _T18;
_T15:
	__asm        inc    i;
_T18:
	__asm        cmp    i, 0x10;
	__asm        jge    _T48;
// LINE 148:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    edx, id;
	__asm        cmp    [eax+ecx+0x28], edx;
	__asm        jne    _T43;
// LINE 149:
	__asm        mov    eax, i;
	__asm        jmp    _T52;
// LINE 151:
_T43:
	__asm        jmp    _T15;
// LINE 152:
_T48:
	__asm        mov    eax, 0xFFFFFFFF;
	__asm        jmp    _T52;
// LINE 153:
_T52:
}

// FUNCTION: COPTER_D 0x004f9e5b
int32_t HeliPassengerSetExpression(/*packed*/ struct tagHeliPassengerData *heliPassengerData, long id, int32_t expression) {
	int32_t i;

// LINE 160:
	__asm        mov    eax, id;
	__asm        push   eax;
	__asm        mov    eax, heliPassengerData;
	__asm        push   eax;
	__asm        call   HeliPassengerGetIndexInHeli;
	__asm        add    esp, 8;
	__asm        mov    i, eax;
// LINE 162:
	__asm        cmp    i, 0xFFFFFFFF;
	__asm        je     _T43;
// LINE 163:
	__asm        mov    eax, expression;
	__asm        mov    ecx, i;
	__asm        shl    ecx, 2;
	__asm        lea    ecx, [ecx+ecx*4];
	__asm        mov    edx, heliPassengerData;
	__asm        mov    [ecx+edx+0x20], eax;
// LINE 164:
	__asm        mov    eax, 1;
	__asm        jmp    _T4a;
// LINE 166:
_T43:
	__asm        xor    eax, eax;
	__asm        jmp    _T4a;
// LINE 167:
_T4a:
}

// FUNCTION: COPTER_D 0x004f9eaa
int32_t HeliPassengerRemove(/*packed*/ struct tagHeliPassengerData *heliPassengerData, long id) {
	int32_t i;

// LINE 174:
	__asm        mov    eax, id;
	__asm        push   eax;
	__asm        mov    eax, heliPassengerData;
	__asm        push   eax;
	__asm        call   HeliPassengerGetIndexInHeli;
	__asm        add    esp, 8;
	__asm        mov    i, eax;
// LINE 176:
	__asm        cmp    i, 0xFFFFFFFF;
	__asm        je     _Tb8;
// LINE 177:
	__asm        mov    eax, heliPassengerData;
	__asm        dec    dword ptr [eax+8];
// LINE 178:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    dword ptr [eax+ecx+0x1C], 0xFFFFFFFF;
// LINE 179:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    dword ptr [eax+ecx+0x20], 0;
// LINE 180:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    dword ptr [eax+ecx+0x24], 0;
// LINE 181:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    dword ptr [eax+ecx+0x28], 0;
// LINE 182:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        mov    dword ptr [eax+ecx+0x2C], 0;
// LINE 183:
	__asm        mov    eax, heliPassengerData;
	__asm        dec    dword ptr [eax+0x18];
// LINE 186:
	__asm        mov    eax, heliPassengerData;
	__asm        push   eax;
	__asm        call   HeliPassengerFitToSeats;
	__asm        add    esp, 4;
// LINE 187:
	__asm        mov    eax, heliPassengerData;
	__asm        push   eax;
	__asm        call   HeliPassengerSetChanged;
	__asm        add    esp, 4;
// LINE 188:
	__asm        mov    eax, 1;
	__asm        jmp    _Tbf;
// LINE 192:
_Tb8:
	__asm        xor    eax, eax;
	__asm        jmp    _Tbf;
// LINE 193:
_Tbf:
}

// FUNCTION: COPTER_D 0x004f9f6e
long HeliPassengerCountFreeSeats(/*packed*/ struct tagHeliPassengerData *heliPassengerData) {
// LINE 204:
	__asm        mov    eax, heliPassengerData;
	__asm        mov    eax, [eax+4];
	__asm        mov    ecx, heliPassengerData;
	__asm        sub    eax, [ecx+8];
	__asm        jmp    near ptr 0x004F9F85;
// LINE 205:
}

// FUNCTION: COPTER_D 0x004f9f8a
void HeliPassengerFitToSeats(/*packed*/ struct tagHeliPassengerData *heliPassengerData) {
	int32_t i;
	int32_t nSeat;
	int32_t bSeats[16];

// LINE 220:
	__asm        mov    i, 0;
	__asm        jmp    _T18;
_T15:
	__asm        inc    i;
_T18:
	__asm        cmp    i, 0x10;
	__asm        jge    _T32;
// LINE 221:
	__asm        mov    eax, i;
	__asm        mov    dword ptr [ebp+eax*4-0x40], 0;
	__asm        jmp    _T15;
// LINE 223:
_T32:
	__asm        mov    i, 0;
	__asm        jmp    _T41;
_T3e:
	__asm        inc    i;
_T41:
	__asm        cmp    i, 0x10;
	__asm        jge    _Ta4;
// LINE 224:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*4];
	__asm        mov    ecx, heliPassengerData;
	__asm        cmp    dword ptr [eax+ecx+0x1C], 0xFFFFFFFF;
	__asm        je     _T9f;
// LINE 225:
	__asm        lea    eax, bSeats[0];
	__asm        push   eax;
	__asm        mov    eax, heliPassengerData;
	__asm        mov    eax, [eax+0x14];
	__asm        push   eax;
	__asm        mov    eax, heliPassengerData;
	__asm        mov    eax, [eax+4];
	__asm        push   eax;
	__asm        push   1;
	__asm        call   FindFreeSeatForPassenger;
	__asm        add    esp, 0x10;
	__asm        mov    nSeat, eax;
// LINE 226:
	__asm        mov    eax, nSeat;
	__asm        mov    dword ptr [ebp+eax*4-0x40], 1;
// LINE 227:
	__asm        mov    eax, nSeat;
	__asm        mov    ecx, i;
	__asm        shl    ecx, 2;
	__asm        lea    ecx, [ecx+ecx*4];
	__asm        mov    edx, heliPassengerData;
	__asm        mov    [ecx+edx+0x2C], eax;
// LINE 229:
_T9f:
	__asm        jmp    _T3e;
// LINE 230:
_Ta4:
}

// FUNCTION: COPTER_D 0x004fa033
int32_t FindFreeSeatForPassenger(int32_t nPassengerSeatUsage, int32_t nSeatsTotal, int32_t nRowWidth, int32_t * bSeats) {
	int32_t j;

// LINE 245:
	__asm        mov    j, 0;
	__asm        jmp    _T18;
_T15:
	__asm        inc    j;
_T18:
	__asm        mov    eax, nSeatsTotal;
	__asm        cmp    j, eax;
	__asm        jge    _T41;
// LINE 246:
	__asm        mov    eax, j;
	__asm        mov    ecx, bSeats;
	__asm        cmp    dword ptr [ecx+eax*4], 0;
	__asm        jne    _T3c;
// LINE 247:
	__asm        mov    eax, j;
	__asm        jmp    _T4b;
// LINE 248:
_T3c:
	__asm        jmp    _T15;
// LINE 249:
_T41:
	__asm        mov    eax, 0xFFFFFFFF;
	__asm        jmp    _T4b;
// LINE 250:
_T4b:
}

