// Module: Tweak.obj
// Source: C:\Copter\source\common\Tweak.c
// autogenerated by simcopter_tool from PDB file

// Type: int32_t;

// Type: int32_t *;

// Type: char *;

// Type: char;

// Type: void;



// Contribution: 1:000c8ad0-000c90b4 Module: 93, 16 byte alignment, code, execute, read, 
// FUNCTION: COPTER_D 0x004c9ad0
int32_t TWKEnQueue(int32_t * *pValues, int32_t nNumValues, char * pszSection) {
	/*bp-0x4*/   int32_t nCt;

// LINE 43:
	__asm        cmp    g_nNextTWKQueueSlot, 0xC8;
	__asm        jle    _T23;
// LINE 44:
	return 0xffffff9b;
// LINE 46:
_T23:
	__asm        cmp    nNumValues, 0x32;
	__asm        jle    _T37;
// LINE 47:
	return 0xffffff99;
// LINE 49:
_T37:
	nCt = 0x0;
	__asm        jmp    _T46;
_T43:
	nCt++;
_T46:
	__asm        mov    eax, nCt;
	__asm        cmp    nNumValues, eax;
	__asm        jle    _T79;
// LINE 50:
	__asm        mov    eax, nCt;
	__asm        mov    ecx, pValues;
	__asm        mov    eax, [ecx+eax*4];
	__asm        mov    ecx, nCt;
	__asm        mov    edx, g_nNextTWKQueueSlot;
	__asm        mov    ebx, edx;
	__asm        shl    edx, 8;
	__asm        sub    edx, ebx;
	__asm        sub    edx, ebx;
	__asm        mov    TWKQueue[0].pValues[edx+ecx*4], eax;
	__asm        jmp    _T43;
// LINE 52:
_T79:
	__asm        mov    eax, pszSection;
	__asm        push   eax;
	__asm        mov    eax, g_nNextTWKQueueSlot;
	__asm        mov    ecx, eax;
	__asm        shl    eax, 8;
	__asm        sub    eax, ecx;
	__asm        sub    eax, ecx;
	__asm        add    eax, 0x63A860;
	__asm        add    eax, 0xCC;
	__asm        push   eax;
	__asm        call   strcpy;
	__asm        add    esp, 8;
// LINE 53:
	__asm        mov    eax, nNumValues;
	__asm        mov    ecx, g_nNextTWKQueueSlot;
	__asm        mov    edx, ecx;
	__asm        shl    ecx, 8;
	__asm        sub    ecx, edx;
	__asm        sub    ecx, edx;
	__asm        mov    TWKQueue[0].nNumCtrls[ecx], eax;
// LINE 54:
	g_nNextTWKQueueSlot++;
// LINE 56:
	return g_nNextTWKQueueSlot;
// LINE 57:
}

// FUNCTION: COPTER_D 0x004c9b9b
int32_t TWKReadFile(char * pszTWKFile, int32_t bIsOnMessageRead) {
	/*bp-0x104*/ char szFullPath[260]; // 0x104 bytes
	/*bp-0x230*/ char szTemp[300]; // 0x12c bytes
	/*bp-0x234*/ int32_t nCt;
	/*bp-0x268*/ char szSection[50]; // 0x32 bytes

// LINE 77:
	g_nNextTWKErrorSlot = 0x0;
// LINE 78:
	GetPathForFile(szFullPath[0], pszTWKFile, 0x0, 0xb);
// LINE 80:
	__asm        lea    eax, szFullPath[0];
	__asm        push   eax;
	__asm        push   0x12C;
	__asm        lea    eax, szTemp[0];
	__asm        push   eax;
	__asm        push   0x59B3B0;
	__asm        push   0x59B3B4;
	__asm        push   0x59B3C0;
	__asm        call   dword ptr ds:[0x6C3618];
// LINE 81:
	__asm        cmp    bIsOnMessageRead, 0;
	__asm        je     _T178;

	__asm        push   0x59B3D8;
	__asm        lea    eax, szTemp[0];
	__asm        push   eax;
	__asm        call   strcmp;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        je     _T178;
// LINE 83:
	__asm        lea    eax, szFullPath[0];
	__asm        push   eax;
	__asm        push   0x32;
	__asm        lea    eax, szSection[0];
	__asm        push   eax;
	__asm        push   0x59B3DC;
	__asm        push   0x59B3F0;
	__asm        push   0x59B3FC;
	__asm        call   dword ptr ds:[0x6C3618];
// LINE 85:
	__asm        push   0x59B414;
	__asm        lea    eax, szSection[0];
	__asm        push   eax;
	__asm        call   strcmp;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _Tc6;
// LINE 86:
	return 0xffffff9a;
// LINE 88:
_Tc6:
	nCt = 0x0;
	__asm        jmp    _Tdb;
_Td5:
	nCt++;
_Tdb:
	__asm        mov    eax, nCt;
	__asm        cmp    g_nNextTWKQueueSlot, eax;
	__asm        jle    _T128;
// LINE 89:
	__asm        lea    eax, szSection[0];
	__asm        push   eax;
	__asm        mov    eax, nCt;
	__asm        mov    ecx, eax;
	__asm        shl    eax, 8;
	__asm        sub    eax, ecx;
	__asm        sub    eax, ecx;
	__asm        add    eax, 0x63A860;
	__asm        add    eax, 0xCC;
	__asm        push   eax;
	__asm        call   strcmp;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T123;
// LINE 90:
	__asm        jmp    _T128;
// LINE 92:
_T123:
	__asm        jmp    _Td5;
_T128:
	__asm        mov    eax, nCt;
	__asm        cmp    g_nNextTWKQueueSlot, eax;
	__asm        je     _T173;
// LINE 93:
	__asm        mov    eax, nCt;
	__asm        push   eax;
	__asm        lea    eax, szSection[0];
	__asm        push   eax;
	__asm        lea    eax, szTemp[0];
	__asm        push   eax;
	__asm        call   TWKReadSection;
	__asm        add    esp, 0xC;
// LINE 95:
	__asm        lea    eax, szFullPath[0];
	__asm        push   eax;
	__asm        push   0x59B428;
	__asm        push   0x59B42C;
	__asm        push   0x59B438;
	__asm        call   dword ptr ds:[0x6C3794];
// LINE 98:
_T173:
	__asm        jmp    _T184;
// LINE 99:
_T178:
	__asm        mov    eax, pszTWKFile;
	__asm        push   eax;
	__asm        call   TWKReadAllFiles;
	__asm        add    esp, 4;
// LINE 104:
_T184:
	return g_nNextTWKErrorSlot;
// LINE 105:
}

// FUNCTION: COPTER_D 0x004c9d2e
void TWKGameInit() {
// LINE 117:
	__asm        push   0x59B450;
	__asm        call   dword ptr ds:[0x6C37E4];
	__asm        mov    g_uTWKMessageNum, eax;
// LINE 119:
	g_nNextTWKQueueSlot = 0x0;
// LINE 120:
	g_nNextTWKErrorSlot = 0x0;
// LINE 121:
}

// FUNCTION: COPTER_D 0x004c9d5d
void TWKUpdate() {
// LINE 142:
}

// FUNCTION: COPTER_D 0x004c9d68
void TWKReadAllFiles(char * pszTWKFile) {
	/*bp-0x4*/   char * pszFile;
	/*bp-0x108*/ char szFullPath[260]; // 0x104 bytes
	/*bp-0x234*/ char szTemp[300]; // 0x12c bytes
	/*bp-0x238*/ int32_t nCt;
	/*bp-0x23c*/ char * pszSection;

// LINE 170:
	GetPathForFile(szFullPath[0], pszTWKFile, 0x0, 0xb);
// LINE 171:
	nCt = 0x0;
	__asm        jmp    _T38;
_T32:
	nCt++;
_T38:
	__asm        mov    eax, nCt;
	__asm        cmp    g_nNextTWKQueueSlot, eax;
	__asm        jle    __RETURN;
// LINE 172:
	__asm        mov    eax, nCt;
	__asm        mov    ecx, eax;
	__asm        shl    eax, 8;
	__asm        sub    eax, ecx;
	__asm        sub    eax, ecx;
	__asm        add    eax, 0x63A860;
	__asm        add    eax, 0xCC;
	__asm        mov    pszSection, eax;
// LINE 175:
	__asm        lea    eax, szFullPath[0];
	__asm        push   eax;
	__asm        push   0x12C;
	__asm        lea    eax, szTemp[0];
	__asm        push   eax;
	__asm        push   0x59B460;
	__asm        push   0x59B46C;
	__asm        mov    eax, pszSection;
	__asm        push   eax;
	__asm        call   dword ptr ds:[0x6C3618];
// LINE 176:
	__asm        push   0x59B478;
	__asm        lea    eax, szTemp[0];
	__asm        push   eax;
	__asm        call   strcmp;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        je     _Tbd;
// LINE 177:
	pszFile = szTemp[0];
// LINE 178:
	__asm        jmp    _Tc3;
// LINE 179:
_Tbd:
	pszFile = pszTWKFile;
// LINE 184:
_Tc3:
	__asm        mov    eax, nCt;
	__asm        push   eax;
	__asm        mov    eax, pszSection;
	__asm        push   eax;
	__asm        mov    eax, pszFile;
	__asm        push   eax;
	__asm        call   TWKReadSection;
	__asm        add    esp, 0xC;
// LINE 185:
	__asm        jmp    _T32;
// LINE 191:
__RETURN:
}

// FUNCTION: COPTER_D 0x004c9e4f
void TWKReadSection(char * pszFile, char * pszSection, int32_t nTweakQueueSlotIdx) {
	/*bp-0x10*/  char szValue[15]; // 0xf bytes
	/*bp-0x114*/ char szFullPath[260]; // 0x104 bytes
	/*bp-0x118*/ int32_t nCt2;
	/*bp-0x11c*/ int32_t nNumCtrl;
	/*bp-0x130*/ char szDataType[20]; // 0x14 bytes
	/*bp-0x164*/ char szKey[50]; // 0x32 bytes

// LINE 211:
	sprintf(0x59b484, 0x59b48c, szKey[0]);
// LINE 212:
	GetPathForFile(szFullPath[0], pszFile, 0x0, 0xb);
// LINE 213:
	__asm        lea    eax, szFullPath[0];
	__asm        push   eax;
	__asm        push   0xFFFFFF9A;
	__asm        lea    eax, szKey[0];
	__asm        push   eax;
	__asm        mov    eax, pszSection;
	__asm        push   eax;
	__asm        call   dword ptr ds:[0x6C361C];
	__asm        mov    nNumCtrl, eax;
// LINE 214:
	__asm        cmp    nNumCtrl, 0xFFFFFF9A;
	__asm        je     _T1ef;
// LINE 216:
	nCt2 = 0x0;
	__asm        jmp    _T7e;
_T78:
	nCt2++;
_T7e:
	__asm        mov    eax, nCt2;
	__asm        cmp    nNumCtrl, eax;
	__asm        jle    _T1ea;
// LINE 217:
	sprintf(0x59b490, nCt2, 0x59b498, 0x59b4a0, szKey[0]);
// LINE 219:
	__asm        lea    eax, szFullPath[0];
	__asm        push   eax;
	__asm        push   0xF;
	__asm        lea    eax, szValue[0];
	__asm        push   eax;
	__asm        push   0x59B4A8;
	__asm        lea    eax, szKey[0];
	__asm        push   eax;
	__asm        mov    eax, pszSection;
	__asm        push   eax;
	__asm        call   dword ptr ds:[0x6C3618];
// LINE 220:
	sprintf(0x59b4bc, nCt2, 0x59b4c8, 0x59b4d0, szKey[0]);
// LINE 222:
	__asm        lea    eax, szFullPath[0];
	__asm        push   eax;
	__asm        push   0x14;
	__asm        lea    eax, szDataType[0];
	__asm        push   eax;
	__asm        push   0x59B4D8;
	__asm        lea    eax, szKey[0];
	__asm        push   eax;
	__asm        mov    eax, pszSection;
	__asm        push   eax;
	__asm        call   dword ptr ds:[0x6C3618];
// LINE 225:
	__asm        push   0x59B4E8;
	__asm        lea    eax, szDataType[0];
	__asm        push   eax;
	__asm        call   strcmp;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T176;
// LINE 226:
	__asm        lea    eax, szValue[0];
	__asm        push   eax;
	__asm        call   atof;
	__asm        add    esp, 4;
	__asm        fmul   qword ptr ds:[0x5923E0];
	__asm        call   0x0056EBE8;
	__asm        mov    ecx, nCt2;
	__asm        mov    edx, nTweakQueueSlotIdx;
	__asm        mov    ebx, edx;
	__asm        shl    edx, 8;
	__asm        sub    edx, ebx;
	__asm        sub    edx, ebx;
	__asm        mov    ecx, TWKQueue[0].pValues[edx+ecx*4];
	__asm        mov    [ecx], eax;
// LINE 227:
	__asm        jmp    _T1e5;
// LINE 228:
_T176:
	__asm        push   0x59B4F0;
	__asm        lea    eax, szDataType[0];
	__asm        push   eax;
	__asm        call   strcmp;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T1be;
// LINE 229:
	__asm        lea    eax, szValue[0];
	__asm        push   eax;
	__asm        call   atof;
	__asm        add    esp, 4;
	__asm        mov    eax, nCt2;
	__asm        mov    ecx, nTweakQueueSlotIdx;
	__asm        mov    edx, ecx;
	__asm        shl    ecx, 8;
	__asm        sub    ecx, edx;
	__asm        sub    ecx, edx;
	__asm        mov    eax, TWKQueue[0].pValues[ecx+eax*4];
	__asm        fstp   qword ptr [eax];
// LINE 230:
	__asm        jmp    _T1e5;
// LINE 231:
_T1be:
	__asm        lea    eax, szValue[0];
	__asm        push   eax;
	__asm        call   atoi;
	__asm        add    esp, 4;
	__asm        mov    ecx, nCt2;
	__asm        mov    edx, nTweakQueueSlotIdx;
	__asm        mov    ebx, edx;
	__asm        shl    edx, 8;
	__asm        sub    edx, ebx;
	__asm        sub    edx, ebx;
	__asm        mov    ecx, TWKQueue[0].pValues[edx+ecx*4];
	__asm        mov    [ecx], eax;
// LINE 232:
_T1e5:
	__asm        jmp    _T78;
// LINE 234:
_T1ea:
	return;
// LINE 245:
_T1ef:
	__asm        mov    eax, nTweakQueueSlotIdx;
	__asm        mov    ecx, g_nNextTWKErrorSlot;
	__asm        mov    TWKErrorSlot[ecx*4], eax;
// LINE 246:
	g_nNextTWKErrorSlot++;
// LINE 249:
}

// FUNCTION: COPTER_D 0x004ca059
int32_t TWKDOSRead(char * pszTWKFile) {
// LINE 265:
	return g_nNextTWKErrorSlot;
// LINE 352:
}

// FUNCTION: COPTER_D 0x004ca06e
void TWKGetToEOLN(char * pDest, char * pSource) {
	/*bp-0x4*/   int32_t nCt;

// LINE 362:
	nCt = 0x0;
// LINE 363:
_T10:
	__asm        mov    eax, pSource;
	__asm        movsx  eax, byte ptr [eax];
	__asm        cmp    eax, 0xD;
	__asm        je     _T38;
// LINE 364:
	__asm        mov    eax, pSource;
	__asm        mov    al, [eax];
	__asm        mov    ecx, nCt;
	__asm        mov    edx, pDest;
	__asm        mov    [ecx+edx], al;
// LINE 365:
	pSource++;
// LINE 366:
	nCt++;
// LINE 367:
	__asm        jmp    _T10;
// LINE 368:
_T38:
	__asm        mov    eax, nCt;
	__asm        mov    ecx, pDest;
	__asm        mov    byte ptr [eax+ecx], 0;
// LINE 369:
}



// Contribution: 2:000033e0-000033e7 Module: 93, 8 byte alignment, initialized_data, read, 


// Contribution: 3:000043a8-000044f6 Module: 93, 4 byte alignment, initialized_data, read, write, 
// GLOBAL: COPTER_D 0x0059b3a8
int32_t g_nNextTWKQueueSlot = 0;

// GLOBAL: COPTER_D 0x0059b3ac
int32_t g_nNextTWKErrorSlot = 0;



// Unknown globals:
// The PDB was slightly corrupted and we aren't sure which file these globals belong to.
// GLOBAL: COPTER_D 0x00646ee0
int32_t TWKErrorSlot[200]; // Contrib missing

// GLOBAL: COPTER_D 0x0063a860
/*packed*/ struct tagTWKEntry TWKQueue[200]; // Contrib missing


// WARNING: this global might actually belong to: C:\Copter\source\common\S2lodsav.c
// GLOBAL: COPTER_D 0x0063a860
/*packed*/ struct tagTWKEntry TWKQueue[200]; // Contrib missing

// GLOBAL: COPTER_D 0x00646ee0
int32_t TWKErrorSlot[200]; // Contrib missing

