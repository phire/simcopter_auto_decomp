// Module: Lighting.obj
// Source: C:\Copter\source\engine\Lighting.c
// autogenerated by simcopter_tool from PDB file

// Type: struct VRResource (forward reference);

// Type: int32_t;

// Type: unsigned char *;

// Type: struct TEXT_Resource (forward reference);

// Type: struct VRBmpHdr (forward reference);

// Type: uint32_t *;

// Type: int32_t *;

// Type: struct _FaceHdr (forward reference);

// Type: void;

// Type: struct COLOR_SHADE (forward reference);

// Type: struct VRObjInfo;
struct VRObjInfo{
	int32_t Faces;
	int32_t Verts;
	int32_t Attribute;
	int32_t Radius;
	struct Point3d* ObjCenter;
	struct Point3d* VertsPtr;
	struct Xform3d* VertsXfm;
	struct Point3d* OrgVerts;
	int32_t[4][4]* Matrix;
};

// Type: int32_t[4][4];

// Type: struct Point3d;
struct Point3d{
	int32_t x;
	int32_t y;
	int32_t z;
};

// Type: struct ObjectHdr (forward reference);

// Type: struct Point3d (forward reference);



// Contribution: 1:000d7cc0-000d89a4 Module: 132, 16 byte alignment, code, execute, read, 
// FUNCTION: COPTER_D 0x004d8cc0
int32_t VRCreateTexColors(struct VRResource* res, int32_t create_new) {
	unsigned char * tptr;
	int32_t maxcolor;
	struct TEXT_Resource* hdr;
	int32_t j;
	int32_t i;
	int32_t maxval;
	struct VRBmpHdr* bhdr;

// LINE 122:
	__asm        mov    eax, res;
	__asm        mov    hdr, eax;
// LINE 123:
	__asm        mov    eax, hdr;
	__asm        mov    ds:[0x606A70], eax;
// LINE 126:
	__asm        cmp    create_new, 1;
	__asm        jne    _T40;
// LINE 129:
	__asm        mov    eax, hdr;
	__asm        mov    eax, [eax+0x10];
	__asm        shl    eax, 2;
	__asm        push   eax;
	__asm        mov    eax, res;
	__asm        mov    eax, [eax+4];
	__asm        push   eax;
	__asm        call   S2Alloc;
	__asm        add    esp, 8;
	__asm        mov    ecx, hdr;
	__asm        mov    [ecx+0x14], eax;
// LINE 132:
_T40:
	__asm        mov    eax, hdr;
	__asm        cmp    dword ptr [eax+0x14], 0;
	__asm        jne    _T61;
// LINE 134:
	__asm        mov    dword ptr ds:[0x662810], 4;
// LINE 135:
	__asm        mov    eax, 1;
	__asm        jmp    _T193;
// LINE 141:
_T61:
	__asm        mov    i, 0;
	__asm        jmp    _T70;
_T6d:
	__asm        inc    i;
_T70:
	__asm        mov    eax, hdr;
	__asm        mov    ecx, i;
	__asm        cmp    [eax+0x10], ecx;
	__asm        jle    _T18c;
// LINE 143:
	__asm        mov    eax, i;
	__asm        push   eax;
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   VRInt2BmpHdr;
	__asm        add    esp, 8;
	__asm        mov    bhdr, eax;
// LINE 146:
	__asm        mov    eax, bhdr;
	__asm        movsx  eax, word ptr [eax+8];
	__asm        test   al, 4;
	__asm        je     _Tc7;
// LINE 148:
	__asm        mov    eax, create_new;
	__asm        push   eax;
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        mov    eax, bhdr;
	__asm        push   eax;
	__asm        mov    eax, hdr;
	__asm        mov    eax, [eax+0x14];
	__asm        mov    ecx, i;
	__asm        lea    eax, [eax+ecx*4];
	__asm        push   eax;
	__asm        call   CreateTiledTexColors;
	__asm        add    esp, 0x10;
// LINE 149:
	__asm        jmp    _T6d;
// LINE 152:
_Tc7:
	__asm        mov    eax, bhdr;
	__asm        mov    tptr, eax;
// LINE 153:
	__asm        mov    eax, bhdr;
	__asm        mov    eax, [eax+4];
	__asm        shl    eax, 2;
	__asm        add    eax, 0xC;
	__asm        add    tptr, eax;
// LINE 154:
	__asm        push   0x400;
	__asm        push   0;
	__asm        push   0x606A78;
	__asm        call   memset;
	__asm        add    esp, 0xC;
// LINE 156:
	__asm        mov    j, 0;
	__asm        jmp    _Tff;
_Tfc:
	__asm        inc    j;
_Tff:
	__asm        mov    eax, bhdr;
	__asm        mov    eax, [eax+4];
	__asm        mov    ecx, bhdr;
	__asm        imul   eax, [ecx];
	__asm        cmp    eax, j;
	__asm        jle    _T12a;
// LINE 158:
	__asm        mov    eax, tptr;
	__asm        xor    ecx, ecx;
	__asm        mov    cl, [eax];
	__asm        inc    dword ptr [ecx*4+0x606A78];
// LINE 159:
	__asm        inc    tptr;
// LINE 160:
	__asm        jmp    _Tfc;
// LINE 162:
_T12a:
	__asm        mov    maxval, 0;
// LINE 163:
	__asm        mov    j, 0;
	__asm        jmp    _T140;
_T13d:
	__asm        inc    j;
_T140:
	__asm        cmp    j, 0x100;
	__asm        jge    _T178;
// LINE 165:
	__asm        mov    eax, j;
	__asm        mov    ecx, maxval;
	__asm        cmp    [eax*4+0x606A78], ecx;
	__asm        jle    _T173;
// LINE 167:
	__asm        mov    eax, j;
	__asm        mov    eax, [eax*4+0x606A78];
	__asm        mov    maxval, eax;
// LINE 168:
	__asm        mov    eax, j;
	__asm        mov    maxcolor, eax;
// LINE 170:
_T173:
	__asm        jmp    _T13d;
// LINE 171:
_T178:
	__asm        mov    eax, maxcolor;
	__asm        mov    ecx, hdr;
	__asm        mov    ecx, [ecx+0x14];
	__asm        mov    edx, i;
	__asm        mov    [ecx+edx*4], eax;
// LINE 172:
	__asm        jmp    _T6d;
// LINE 174:
_T18c:
	__asm        xor    eax, eax;
	__asm        jmp    _T193;
// LINE 175:
_T193:
}

// FUNCTION: COPTER_D 0x004d8e58
int32_t CreateTiledTexColors(uint32_t * tabentry, struct VRBmpHdr* bhdr, struct VRResource* res, int32_t create_new) {
	unsigned char * tptr;
	unsigned char * ltptr;
	int32_t maxcolor;
	int32_t k;
	int32_t j;
	int32_t i;
	uint32_t * bmpcolors;
	int32_t maxval;
	int32_t notiles;

// LINE 201:
	__asm        mov    ecx, bhdr;
	__asm        mov    eax, 0x100;
	__asm        cdq;
	__asm        idiv   dword ptr [ecx];
	__asm        mov    notiles, eax;
// LINE 202:
	__asm        mov    eax, notiles;
	__asm        imul   eax, notiles;
	__asm        mov    notiles, eax;
// LINE 205:
	__asm        cmp    create_new, 1;
	__asm        jne    _T64;
// LINE 207:
	__asm        mov    eax, notiles;
	__asm        shl    eax, 2;
	__asm        push   eax;
	__asm        mov    eax, res;
	__asm        mov    eax, [eax+4];
	__asm        push   eax;
	__asm        call   S2Alloc;
	__asm        add    esp, 8;
	__asm        mov    bmpcolors, eax;
// LINE 208:
	__asm        mov    eax, bmpcolors;
	__asm        mov    ecx, tabentry;
	__asm        mov    [ecx], eax;
// LINE 209:
	__asm        mov    eax, tabentry;
	__asm        cmp    dword ptr [eax], 0;
	__asm        jne    _T5f;
// LINE 210:
	__asm        xor    eax, eax;
	__asm        jmp    _T17a;
// LINE 212:
_T5f:
	__asm        jmp    _T6c;
// LINE 214:
_T64:
	__asm        mov    eax, tabentry;
	__asm        mov    eax, [eax];
	__asm        mov    bmpcolors, eax;
// LINE 224:
_T6c:
	__asm        mov    i, 0;
	__asm        jmp    _T7b;
_T78:
	__asm        inc    i;
_T7b:
	__asm        mov    eax, notiles;
	__asm        cmp    i, eax;
	__asm        jge    _T170;
// LINE 226:
	__asm        mov    eax, i;
	__asm        mov    ecx, bhdr;
	__asm        mov    eax, [ecx+eax*8+0x10];
	__asm        mov    tptr, eax;
	__asm        mov    eax, tptr;
	__asm        mov    ltptr, eax;
// LINE 228:
	__asm        push   0x400;
	__asm        push   0;
	__asm        push   0x606A78;
	__asm        call   memset;
	__asm        add    esp, 0xC;
// LINE 231:
	__asm        mov    j, 0;
	__asm        jmp    _Tbd;
_Tba:
	__asm        inc    j;
_Tbd:
	__asm        mov    eax, bhdr;
	__asm        mov    ecx, j;
	__asm        cmp    [eax+4], ecx;
	__asm        jle    _T111;
// LINE 233:
	__asm        mov    k, 0;
	__asm        jmp    _Tdb;
_Td8:
	__asm        inc    k;
_Tdb:
	__asm        mov    eax, bhdr;
	__asm        mov    ecx, k;
	__asm        cmp    [eax], ecx;
	__asm        jle    _Tff;
// LINE 235:
	__asm        mov    eax, tptr;
	__asm        xor    ecx, ecx;
	__asm        mov    cl, [eax];
	__asm        inc    dword ptr [ecx*4+0x606A78];
// LINE 236:
	__asm        inc    tptr;
// LINE 237:
	__asm        jmp    _Td8;
// LINE 238:
_Tff:
	__asm        add    ltptr, 0x100;
// LINE 239:
	__asm        mov    eax, ltptr;
	__asm        mov    tptr, eax;
// LINE 240:
	__asm        jmp    _Tba;
// LINE 243:
_T111:
	__asm        mov    maxval, 0;
// LINE 244:
	__asm        mov    j, 0;
	__asm        jmp    _T127;
_T124:
	__asm        inc    j;
_T127:
	__asm        cmp    j, 0x100;
	__asm        jge    _T15f;
// LINE 246:
	__asm        mov    eax, j;
	__asm        mov    ecx, maxval;
	__asm        cmp    [eax*4+0x606A78], ecx;
	__asm        jle    _T15a;
// LINE 248:
	__asm        mov    eax, j;
	__asm        mov    eax, [eax*4+0x606A78];
	__asm        mov    maxval, eax;
// LINE 249:
	__asm        mov    eax, j;
	__asm        mov    maxcolor, eax;
// LINE 251:
_T15a:
	__asm        jmp    _T124;
// LINE 252:
_T15f:
	__asm        mov    eax, maxcolor;
	__asm        mov    ecx, i;
	__asm        mov    edx, bmpcolors;
	__asm        mov    [edx+ecx*4], eax;
// LINE 253:
	__asm        jmp    _T78;
// LINE 255:
_T170:
	__asm        mov    eax, 1;
	__asm        jmp    _T17a;
// LINE 256:
_T17a:
}

// FUNCTION: COPTER_D 0x004d8fd7
void VRFaceSetTexColor(int32_t face) {
	int32_t hiword;
	int32_t * tilebmpcolors;
	struct _FaceHdr* fh;
	int32_t loword;

// LINE 272:
	__asm        mov    eax, face;
	__asm        mov    fh, eax;
// LINE 281:
	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+8], 1;
	__asm        jne    _T50;

	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+9], 8;
	__asm        jne    _T50;

	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+9], 0x80;
	__asm        jne    _T50;

	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+0xA], 1;
	__asm        jne    _T50;

	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+9], 0x40;
	__asm        je     _T55;
// LINE 282:
_T50:
	__asm        jmp    _Tb7;
// LINE 288:
_T55:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x24];
	__asm        sar    eax, 0x10;
	__asm        mov    hiword, eax;
// LINE 289:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x24];
	__asm        and    eax, 0xFFFF;
	__asm        mov    loword, eax;
// LINE 291:
	__asm        cmp    hiword, 0;
	__asm        je     _T9e;
// LINE 293:
	__asm        mov    eax, ds:[0x606A70];
	__asm        mov    eax, [eax+0x14];
	__asm        mov    ecx, hiword;
	__asm        mov    eax, [eax+ecx*4];
	__asm        mov    tilebmpcolors, eax;
// LINE 294:
	__asm        mov    eax, loword;
	__asm        mov    ecx, tilebmpcolors;
	__asm        mov    eax, [ecx+eax*4];
	__asm        mov    ecx, fh;
	__asm        mov    [ecx+0xC], eax;
// LINE 296:
	__asm        jmp    _Tb2;
// LINE 298:
_T9e:
	__asm        mov    eax, ds:[0x606A70];
	__asm        mov    eax, [eax+0x14];
	__asm        mov    ecx, loword;
	__asm        mov    eax, [eax+ecx*4];
	__asm        mov    ecx, fh;
	__asm        mov    [ecx+0xC], eax;
// LINE 301:
_Tb2:
	__asm        jmp    _Tb7;
// LINE 302:
_Tb7:
}

// FUNCTION: COPTER_D 0x004d9093
int32_t VRGetTexColor(int32_t bitmap) {
	int32_t hiword;
	int32_t * tilebmpcolors;
	int32_t color;
	int32_t loword;

// LINE 322:
	__asm        mov    eax, bitmap;
	__asm        sar    eax, 0x10;
	__asm        mov    hiword, eax;
// LINE 323:
	__asm        mov    eax, bitmap;
	__asm        and    eax, 0xFFFF;
	__asm        mov    loword, eax;
// LINE 325:
	__asm        cmp    hiword, 0;
	__asm        je     _T49;
// LINE 327:
	__asm        mov    eax, ds:[0x606A70];
	__asm        mov    eax, [eax+0x14];
	__asm        mov    ecx, hiword;
	__asm        mov    eax, [eax+ecx*4];
	__asm        mov    tilebmpcolors, eax;
// LINE 328:
	__asm        mov    eax, loword;
	__asm        mov    ecx, tilebmpcolors;
	__asm        mov    eax, [ecx+eax*4];
	__asm        mov    color, eax;
// LINE 330:
	__asm        jmp    _T5a;
// LINE 332:
_T49:
	__asm        mov    eax, ds:[0x606A70];
	__asm        mov    eax, [eax+0x14];
	__asm        mov    ecx, loword;
	__asm        mov    eax, [eax+ecx*4];
	__asm        mov    color, eax;
// LINE 334:
_T5a:
	__asm        mov    eax, color;
	__asm        jmp    near ptr 0x004D90F5;
// LINE 335:
}

// FUNCTION: COPTER_D 0x004d90fa
struct COLOR_SHADE* VRGetColorShade(int32_t color) {
	struct COLOR_SHADE* cptr;

// LINE 348:
	__asm        mov    cptr, 0x5ADC10;
// LINE 350:
	__asm        cmp    color, 0;
	__asm        jl     _T27;

	__asm        cmp    color, 0x100;
	__asm        jle    _T2e;
// LINE 351:
_T27:
	__asm        xor    eax, eax;
	__asm        jmp    _T61;
// LINE 355:
_T2e:
	__asm        mov    eax, cptr;
	__asm        mov    ecx, color;
	__asm        cmp    [eax], ecx;
	__asm        jg     _T58;

	__asm        mov    eax, cptr;
	__asm        mov    eax, [eax+4];
	__asm        mov    ecx, cptr;
	__asm        add    eax, [ecx];
	__asm        cmp    eax, color;
	__asm        jle    _T58;
// LINE 356:
	__asm        mov    eax, cptr;
	__asm        jmp    _T61;
// LINE 358:
_T58:
	__asm        add    cptr, 8;
// LINE 359:
	__asm        jmp    _T2e;
// LINE 361:
_T61:
}

// FUNCTION: COPTER_D 0x004d9160
void VRSetIntensities(int32_t ambient, int32_t var1, int32_t var2, int32_t var3) {
// LINE 371:
	__asm        mov    eax, ambient;
	__asm        mov    ds:[0x5ADD5C], eax;
// LINE 372:
	__asm        mov    eax, var1;
	__asm        mov    ds:[0x5ADD60], eax;
// LINE 373:
	__asm        mov    eax, var2;
	__asm        mov    ds:[0x5ADD64], eax;
// LINE 374:
	__asm        mov    eax, var3;
	__asm        mov    ds:[0x5ADD68], eax;
// LINE 375:
}

// FUNCTION: COPTER_D 0x004d918b
void VRObjSetShading(int32_t obj) {
	struct COLOR_SHADE* cptr;
	int32_t intensity;
	int32_t i;
	struct _FaceHdr* fh;
	int32_t color;
	int32_t face;
	struct VRObjInfo oinfo;
	int32_t diffuse;
	int32_t level;

// LINE 399:
	__asm        lea    eax, oinfo.Faces;
	__asm        push   eax;
	__asm        mov    eax, obj;
	__asm        push   eax;
	__asm        call   0x004D8859;
	__asm        add    esp, 8;
// LINE 400:
	__asm        mov    eax, obj;
	__asm        push   eax;
	__asm        call   0x004D85CD;
	__asm        add    esp, 4;
	__asm        mov    face, eax;
// LINE 401:
	__asm        mov    i, 0;
	__asm        jmp    _T37;
_T34:
	__asm        inc    i;
_T37:
	__asm        mov    eax, i;
	__asm        cmp    oinfo.Faces, eax;
	__asm        jle    _T246;
// LINE 403:
	__asm        mov    eax, face;
	__asm        mov    fh, eax;
// LINE 406:
	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+8], 4;
	__asm        jne    _T70;

	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+9], 0x80;
	__asm        jne    _T70;

	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+0xA], 1;
	__asm        je     _T75;
// LINE 408:
_T70:
	__asm        jmp    _T232;
// LINE 411:
_T75:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0xC];
	__asm        push   eax;
	__asm        call   VRGetColorShade;
	__asm        add    esp, 4;
	__asm        mov    cptr, eax;
// LINE 412:
	__asm        cmp    cptr, 0;
	__asm        jne    _T96;

	__asm        jmp    _T232;
// LINE 416:
_T96:
	__asm        mov    intensity, 0;
// LINE 419:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x2C];
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD38];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    ebx, eax;
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x2C];
	__asm        mov    eax, [eax+4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD34];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    ebx, eax;
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x2C];
	__asm        mov    eax, [eax];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD30];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    ebx, eax;
	__asm        mov    diffuse, ebx;
// LINE 421:
	__asm        cmp    diffuse, 0;
	__asm        jle    _T10c;
// LINE 422:
	__asm        mov    eax, ds:[0x5ADD60];
	__asm        push   eax;
	__asm        mov    eax, diffuse;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    intensity, eax;
// LINE 427:
_T10c:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x2C];
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD48];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    ebx, eax;
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x2C];
	__asm        mov    eax, [eax+4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD44];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    ebx, eax;
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x2C];
	__asm        mov    eax, [eax];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD40];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    ebx, eax;
	__asm        mov    diffuse, ebx;
// LINE 429:
	__asm        cmp    diffuse, 0;
	__asm        jle    _T17b;
// LINE 430:
	__asm        mov    eax, ds:[0x5ADD64];
	__asm        push   eax;
	__asm        mov    eax, diffuse;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    intensity, eax;
// LINE 433:
_T17b:
	__asm        mov    eax, ds:[0x5ADD5C];
	__asm        add    intensity, eax;
// LINE 435:
	__asm        cmp    intensity, 0x10000;
	__asm        jl     _T1a4;
// LINE 437:
	__asm        mov    eax, cptr;
	__asm        mov    eax, [eax+4];
	__asm        mov    ecx, cptr;
	__asm        add    eax, [ecx];
	__asm        dec    eax;
	__asm        mov    color, eax;
// LINE 439:
	__asm        jmp    _T1cc;
// LINE 441:
_T1a4:
	__asm        mov    eax, intensity;
	__asm        push   eax;
	__asm        mov    eax, cptr;
	__asm        mov    eax, [eax+4];
	__asm        shl    eax, 0x10;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    level, eax;
// LINE 442:
	__asm        sar    level, 0x10;
// LINE 443:
	__asm        mov    eax, cptr;
	__asm        mov    eax, [eax];
	__asm        add    eax, level;
	__asm        mov    color, eax;
// LINE 449:
_T1cc:
	__asm        cmp    color, 0xEA;
	__asm        jl     _T1f9;

	__asm        cmp    color, 0xF5;
	__asm        jg     _T1f9;
// LINE 451:
	__asm        mov    eax, 0xF5;
	__asm        mov    ecx, color;
	__asm        sub    ecx, 0xEA;
	__asm        sub    eax, ecx;
	__asm        mov    color, eax;
// LINE 454:
_T1f9:
	__asm        mov    eax, color;
	__asm        mov    ecx, fh;
	__asm        mov    [ecx+0xC], eax;
// LINE 457:
	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+8], 1;
	__asm        jne    _T21c;

	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+9], 8;
	__asm        je     _T232;
_T21c:
	__asm        mov    eax, fh;
	__asm        cmp    dword ptr [eax+0x10], 0xB;
	__asm        je     _T232;
// LINE 458:
	__asm        mov    eax, color;
	__asm        mov    ecx, fh;
	__asm        mov    [ecx+0x24], eax;
// LINE 461:
next_face:
_T232:
	__asm        mov    eax, face;
	__asm        push   eax;
	__asm        call   0x004D85F8;
	__asm        add    esp, 4;
	__asm        mov    face, eax;
// LINE 462:
	__asm        jmp    _T34;
// LINE 463:
_T246:
}

// FUNCTION: COPTER_D 0x004d93d6
void VRDyObjSetShading(int32_t obj, int32_t[4][4]* tmat) {
	struct Point3d rotlitevect;
	struct COLOR_SHADE* cptr;
	struct ObjectHdr* oh;
	int32_t intensity;
	int32_t i;
	struct _FaceHdr* fh;
	int32_t color;
	int32_t diffuse;
	int32_t level;

// LINE 481:
	__asm        mov    eax, obj;
	__asm        mov    oh, eax;
// LINE 489:
	__asm        mov    eax, oh;
	__asm        test   byte ptr [eax+1], 1;
	__asm        jne    _T21;
// LINE 490:
	__asm        jmp    _T1b1;
// LINE 493:
_T21:
	__asm        mov    eax, tmat;
	__asm        push   eax;
	__asm        lea    eax, rotlitevect.x;
	__asm        push   eax;
	__asm        push   0x5ADD50;
	__asm        call   0x004D2094;
	__asm        add    esp, 0xC;
// LINE 496:
	__asm        mov    eax, oh;
	__asm        mov    eax, [eax+0x4C];
	__asm        mov    fh, eax;
// LINE 497:
	__asm        mov    i, 0;
	__asm        jmp    _T4e;
_T4b:
	__asm        inc    i;
_T4e:
	__asm        mov    eax, oh;
	__asm        mov    ecx, i;
	__asm        cmp    [eax+0x10], ecx;
	__asm        jle    _T1b1;
// LINE 500:
	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+8], 4;
	__asm        jne    _T84;

	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+9], 0x80;
	__asm        jne    _T84;

	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+0xA], 1;
	__asm        je     _T89;
// LINE 502:
_T84:
	__asm        jmp    _T1a4;
// LINE 505:
_T89:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0xC];
	__asm        push   eax;
	__asm        call   VRGetColorShade;
	__asm        add    esp, 4;
	__asm        mov    cptr, eax;
// LINE 506:
	__asm        cmp    cptr, 0;
	__asm        jne    _Taa;

	__asm        jmp    _T1a4;
// LINE 510:
_Taa:
	__asm        mov    intensity, 0;
// LINE 513:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x2C];
	__asm        mov    eax, [eax+4];
	__asm        push   eax;
	__asm        mov    eax, rotlitevect.y;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    ebx, eax;
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x2C];
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        mov    eax, rotlitevect.z;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    ebx, eax;
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x2C];
	__asm        mov    eax, [eax];
	__asm        push   eax;
	__asm        mov    eax, rotlitevect.x;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    ebx, eax;
	__asm        mov    diffuse, ebx;
// LINE 515:
	__asm        cmp    diffuse, 0;
	__asm        jle    _T11a;
// LINE 516:
	__asm        mov    eax, ds:[0x5ADD68];
	__asm        push   eax;
	__asm        mov    eax, diffuse;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    intensity, eax;
// LINE 519:
_T11a:
	__asm        mov    eax, ds:[0x5ADD5C];
	__asm        add    intensity, eax;
// LINE 521:
	__asm        cmp    intensity, 0x10000;
	__asm        jl     _T143;
// LINE 523:
	__asm        mov    eax, cptr;
	__asm        mov    eax, [eax+4];
	__asm        mov    ecx, cptr;
	__asm        add    eax, [ecx];
	__asm        dec    eax;
	__asm        mov    color, eax;
// LINE 525:
	__asm        jmp    _T16b;
// LINE 527:
_T143:
	__asm        mov    eax, intensity;
	__asm        push   eax;
	__asm        mov    eax, cptr;
	__asm        mov    eax, [eax+4];
	__asm        shl    eax, 0x10;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    level, eax;
// LINE 528:
	__asm        sar    level, 0x10;
// LINE 529:
	__asm        mov    eax, cptr;
	__asm        mov    eax, [eax];
	__asm        add    eax, level;
	__asm        mov    color, eax;
// LINE 531:
_T16b:
	__asm        mov    eax, color;
	__asm        mov    ecx, fh;
	__asm        mov    [ecx+0xC], eax;
// LINE 534:
	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+8], 1;
	__asm        jne    _T18e;

	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+9], 8;
	__asm        je     _T1a4;
_T18e:
	__asm        mov    eax, fh;
	__asm        cmp    dword ptr [eax+0x10], 0xB;
	__asm        je     _T1a4;
// LINE 535:
	__asm        mov    eax, color;
	__asm        mov    ecx, fh;
	__asm        mov    [ecx+0x24], eax;
// LINE 539:
next_face:
_T1a4:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax];
	__asm        mov    fh, eax;
// LINE 540:
	__asm        jmp    _T4b;
// LINE 541:
_T1b1:
}

// FUNCTION: COPTER_D 0x004d958c
void VRTexTileSqFace(int32_t face, struct VRResource* res, int32_t tf) {
	int32_t i;
	int32_t minv;
	struct _FaceHdr* fh;
	int32_t stvert;
	int32_t minu;

// LINE 563:
	__asm        mov    eax, face;
	__asm        mov    fh, eax;
// LINE 569:
	__asm        mov    eax, fh;
	__asm        cmp    dword ptr [eax+4], 4;
	__asm        je     _T21;
// LINE 570:
	__asm        jmp    _T181;
// LINE 573:
_T21:
	__asm        mov    stvert, 0;
// LINE 574:
	__asm        mov    minu, 0x1E0000;
// LINE 575:
	__asm        mov    minv, 0x1E0000;
// LINE 576:
	__asm        mov    i, 0;
	__asm        jmp    _T45;
_T42:
	__asm        inc    i;
_T45:
	__asm        cmp    i, 4;
	__asm        jge    _Ta4;
// LINE 578:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x28];
	__asm        mov    ecx, i;
	__asm        mov    edx, minu;
	__asm        cmp    [eax+ecx*8], edx;
	__asm        jge    _T9f;

	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x28];
	__asm        mov    ecx, i;
	__asm        mov    edx, minv;
	__asm        cmp    [eax+ecx*8+4], edx;
	__asm        jge    _T9f;
// LINE 580:
	__asm        mov    eax, i;
	__asm        mov    stvert, eax;
// LINE 581:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x28];
	__asm        mov    ecx, i;
	__asm        mov    eax, [eax+ecx*8];
	__asm        mov    minu, eax;
// LINE 582:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x28];
	__asm        mov    ecx, i;
	__asm        mov    eax, [eax+ecx*8+4];
	__asm        mov    minv, eax;
// LINE 584:
_T9f:
	__asm        jmp    _T42;
// LINE 587:
_Ta4:
	__asm        mov    eax, stvert;
	__asm        and    eax, 3;
	__asm        mov    ecx, fh;
	__asm        mov    ecx, [ecx+0x20];
	__asm        mov    dword ptr [ecx+eax*8], 0;
// LINE 588:
	__asm        mov    eax, stvert;
	__asm        and    eax, 3;
	__asm        mov    ecx, fh;
	__asm        mov    ecx, [ecx+0x20];
	__asm        mov    dword ptr [ecx+eax*8+4], 0;
// LINE 589:
	__asm        mov    eax, tf;
	__asm        shl    eax, 0x16;
	__asm        mov    ecx, stvert;
	__asm        inc    ecx;
	__asm        and    ecx, 3;
	__asm        mov    edx, fh;
	__asm        mov    edx, [edx+0x20];
	__asm        mov    [edx+ecx*8], eax;
// LINE 590:
	__asm        mov    eax, stvert;
	__asm        inc    eax;
	__asm        and    eax, 3;
	__asm        mov    ecx, fh;
	__asm        mov    ecx, [ecx+0x20];
	__asm        mov    dword ptr [ecx+eax*8+4], 0;
// LINE 591:
	__asm        mov    eax, tf;
	__asm        shl    eax, 0x16;
	__asm        mov    ecx, stvert;
	__asm        sub    ecx, 2;
	__asm        and    ecx, 3;
	__asm        mov    edx, fh;
	__asm        mov    edx, [edx+0x20];
	__asm        mov    [edx+ecx*8], eax;
// LINE 592:
	__asm        mov    eax, tf;
	__asm        shl    eax, 0x16;
	__asm        mov    ecx, stvert;
	__asm        sub    ecx, 2;
	__asm        and    ecx, 3;
	__asm        mov    edx, fh;
	__asm        mov    edx, [edx+0x20];
	__asm        mov    [edx+ecx*8+4], eax;
// LINE 593:
	__asm        mov    eax, stvert;
	__asm        dec    eax;
	__asm        and    eax, 3;
	__asm        mov    ecx, fh;
	__asm        mov    ecx, [ecx+0x20];
	__asm        mov    dword ptr [ecx+eax*8], 0;
// LINE 594:
	__asm        mov    eax, tf;
	__asm        shl    eax, 0x16;
	__asm        mov    ecx, stvert;
	__asm        dec    ecx;
	__asm        and    ecx, 3;
	__asm        mov    edx, fh;
	__asm        mov    edx, [edx+0x20];
	__asm        mov    [edx+ecx*8+4], eax;
// LINE 597:
	__asm        mov    eax, fh;
	__asm        mov    dword ptr [eax+0x10], 0x12;
// LINE 598:
	__asm        mov    eax, face;
	__asm        push   eax;
	__asm        call   VRFaceSetTexColor;
	__asm        add    esp, 4;
// LINE 599:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x24];
	__asm        push   eax;
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   VRInt2BmpHdr;
	__asm        add    esp, 8;
	__asm        mov    ecx, fh;
	__asm        mov    [ecx+0x24], eax;
// LINE 600:
_T181:
}

// FUNCTION: COPTER_D 0x004d9712
void VRObjSetGouraudShade(struct ObjectHdr* oh, struct Point3d* vnorms) {
	struct Point3d* vn;
	struct COLOR_SHADE* cptr;
	int32_t j;
	int32_t intensity;
	int32_t i;
	int32_t * faceverts;
	struct _FaceHdr* fh;
	int32_t color;
	int32_t diffuse;
	int32_t level;
	int32_t vertidx;

// LINE 621:
	__asm        mov    eax, oh;
	__asm        mov    eax, [eax+0x4C];
	__asm        mov    fh, eax;
// LINE 622:
	__asm        mov    i, 0;
	__asm        jmp    _T21;
_T1e:
	__asm        inc    i;
_T21:
	__asm        mov    eax, oh;
	__asm        mov    ecx, i;
	__asm        cmp    [eax+0x10], ecx;
	__asm        jle    _T1f0;
// LINE 624:
	__asm        mov    eax, fh;
	__asm        test   byte ptr [eax+9], 0x40;
	__asm        jne    _T42;

	__asm        jmp    _T1e3;
// LINE 625:
_T42:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0xC];
	__asm        push   eax;
	__asm        call   VRGetColorShade;
	__asm        add    esp, 4;
	__asm        mov    cptr, eax;
// LINE 626:
	__asm        cmp    cptr, 0;
	__asm        jne    _T63;

	__asm        jmp    _T1e3;
// LINE 633:
_T63:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax+0x1C];
	__asm        mov    faceverts, eax;
// LINE 634:
	__asm        mov    j, 0;
	__asm        jmp    _T7b;
_T78:
	__asm        inc    j;
_T7b:
	__asm        mov    eax, fh;
	__asm        mov    ecx, j;
	__asm        cmp    [eax+4], ecx;
	__asm        jle    _T1e3;
// LINE 641:
	__asm        mov    eax, j;
	__asm        mov    ecx, faceverts;
	__asm        mov    eax, [ecx+eax*4];
	__asm        shr    eax, 4;
	__asm        mov    vertidx, eax;
// LINE 642:
	__asm        mov    eax, vertidx;
	__asm        lea    eax, [eax+eax*2];
	__asm        shl    eax, 2;
	__asm        add    eax, vnorms;
	__asm        mov    vn, eax;
// LINE 646:
	__asm        mov    intensity, 0;
// LINE 649:
	__asm        mov    eax, vn;
	__asm        mov    eax, [eax+4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD34];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    ebx, eax;
	__asm        mov    eax, vn;
	__asm        mov    eax, [eax];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD30];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    ebx, eax;
	__asm        mov    eax, vn;
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD38];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    ebx, eax;
	__asm        mov    diffuse, ebx;
// LINE 651:
	__asm        cmp    diffuse, 0;
	__asm        jle    _T115;
// LINE 652:
	__asm        mov    eax, ds:[0x5ADD60];
	__asm        push   eax;
	__asm        mov    eax, diffuse;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    intensity, eax;
// LINE 657:
_T115:
	__asm        mov    eax, vn;
	__asm        mov    eax, [eax+4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD44];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    ebx, eax;
	__asm        mov    eax, vn;
	__asm        mov    eax, [eax];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD40];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    ebx, eax;
	__asm        mov    eax, vn;
	__asm        mov    eax, [eax+8];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x5ADD48];
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    ebx, eax;
	__asm        mov    diffuse, ebx;
// LINE 659:
	__asm        cmp    diffuse, 0;
	__asm        jle    _T17b;
// LINE 660:
	__asm        mov    eax, ds:[0x5ADD64];
	__asm        push   eax;
	__asm        mov    eax, diffuse;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        add    intensity, eax;
// LINE 663:
_T17b:
	__asm        mov    eax, ds:[0x5ADD5C];
	__asm        add    intensity, eax;
// LINE 665:
	__asm        cmp    intensity, 0x10000;
	__asm        jl     _T1a4;
// LINE 667:
	__asm        mov    eax, cptr;
	__asm        mov    eax, [eax+4];
	__asm        mov    ecx, cptr;
	__asm        add    eax, [ecx];
	__asm        dec    eax;
	__asm        mov    color, eax;
// LINE 669:
	__asm        jmp    _T1cc;
// LINE 671:
_T1a4:
	__asm        mov    eax, intensity;
	__asm        push   eax;
	__asm        mov    eax, cptr;
	__asm        mov    eax, [eax+4];
	__asm        shl    eax, 0x10;
	__asm        push   eax;
	__asm        call   0x004D19BD;
	__asm        add    esp, 8;
	__asm        mov    level, eax;
// LINE 672:
	__asm        sar    level, 0x10;
// LINE 673:
	__asm        mov    eax, cptr;
	__asm        mov    eax, [eax];
	__asm        add    eax, level;
	__asm        mov    color, eax;
// LINE 677:
_T1cc:
	__asm        mov    eax, color;
	__asm        shl    eax, 0x10;
	__asm        mov    ecx, fh;
	__asm        mov    ecx, [ecx+0x20];
	__asm        mov    edx, j;
	__asm        mov    [ecx+edx*8], eax;
// LINE 678:
	__asm        jmp    _T78;
// LINE 681:
next_face:
_T1e3:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax];
	__asm        mov    fh, eax;
// LINE 682:
	__asm        jmp    _T1e;
// LINE 683:
_T1f0:
}

// FUNCTION: COPTER_D 0x004d9907
void VRObjSetTranslucent(int32_t obj, struct VRResource* res, int32_t bitmap) {
	struct ObjectHdr* oh;
	int32_t i;
	struct _FaceHdr* fh;
	struct VRBmpHdr* bhdr;

// LINE 699:
	__asm        mov    eax, obj;
	__asm        mov    oh, eax;
// LINE 705:
	__asm        mov    eax, bitmap;
	__asm        push   eax;
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   VRInt2BmpHdr;
	__asm        add    esp, 8;
	__asm        mov    bhdr, eax;
// LINE 708:
	__asm        mov    eax, oh;
	__asm        mov    eax, [eax+0x4C];
	__asm        mov    fh, eax;
// LINE 709:
	__asm        mov    i, 0;
	__asm        jmp    _T3a;
_T37:
	__asm        inc    i;
_T3a:
	__asm        mov    eax, oh;
	__asm        mov    ecx, i;
	__asm        cmp    [eax+0x10], ecx;
	__asm        jle    _T73;
// LINE 711:
	__asm        mov    eax, fh;
	__asm        mov    dword ptr [eax+8], 3;
// LINE 712:
	__asm        mov    eax, fh;
	__asm        mov    dword ptr [eax+0x10], 0xB;
// LINE 713:
	__asm        mov    eax, bhdr;
	__asm        mov    ecx, fh;
	__asm        mov    [ecx+0x24], eax;
// LINE 714:
	__asm        mov    eax, fh;
	__asm        mov    eax, [eax];
	__asm        mov    fh, eax;
// LINE 715:
	__asm        jmp    _T37;
// LINE 716:
_T73:
}

// FUNCTION: COPTER_D 0x004d997f
void VRFaceSetColor(int32_t face, int32_t color) {
	struct _FaceHdr* fh;

// LINE 728:
	__asm        mov    eax, face;
	__asm        mov    fh, eax;
// LINE 730:
	__asm        mov    eax, color;
	__asm        mov    ecx, fh;
	__asm        mov    [ecx+0xC], eax;
// LINE 731:
	__asm        mov    eax, color;
	__asm        mov    ecx, fh;
	__asm        mov    [ecx+0x24], eax;
// LINE 732:
}



// Contribution: 3:00016c10-00016d6b Module: 132, 8 byte alignment, initialized_data, read, write, 
// GLOBAL: COPTER_D 0x005adc10
// G_shadetab
// GLOBAL: COPTER_D 0x005add30
// G_litevect1
// GLOBAL: COPTER_D 0x005add40
// G_litevect2
// GLOBAL: COPTER_D 0x005add50
// G_litevect3
// LOCAL: COPTER_D 0x005add5c
// S_ambient
// LOCAL: COPTER_D 0x005add60
// S_intensity1
// LOCAL: COPTER_D 0x005add64
// S_intensity2
// LOCAL: COPTER_D 0x005add68
// S_intensity3


// Contribution: 3:0006fa70-0006fe77 Module: 132, 8 byte alignment, uninitialized_data, read, write, 
// LOCAL: COPTER_D 0x00606a70
// S_texres
// LOCAL: COPTER_D 0x00606a78
// S_ctrs


// Unknown globals:
// The PDB was slightly corrupted and we aren't sure which file these globals belong to.

// WARNING: this global might actually belong to: Io.obj
// GLOBAL: COPTER_D 0x00654cdc
// VRClearClr
// GLOBAL: COPTER_D 0x00662810
// _GlobalError

// WARNING: this global might actually belong to: matrix.asm
// GLOBAL: COPTER_D 0x00662810
// GlobalError
