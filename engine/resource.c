// Module: Resource.obj
// Source: C:\Copter\source\engine\Resource.c
// autogenerated by simcopter_tool from PDB file

// Type: void;

// Type: struct VRResource (forward reference);

// Type: struct GEOM_Resource (forward reference);

// Type: char *;

// Type: int32_t;

// Type: void * __ptr32;

// Type: struct Chunk;
struct Chunk{
	int32_t Id;
	int32_t Size;
};



// Contribution: 1:000d42c0-000d505d Module: 146, 16 byte alignment, code, execute, read, 
// FUNCTION: COPTER_D 0x004d52c0
void InitResource() {
// LINE 93:
	__asm        push   0x59C230;
	__asm        push   0x6663F0;
	__asm        call   strcpy;
	__asm        add    esp, 8;
// LINE 94:
	__asm        mov    dword ptr ds:[0x6666A0], 0;
// LINE 95:
	__asm        mov    dword ptr ds:[0x6663EC], 0;
// LINE 96:
	__asm        mov    dword ptr ds:[0x666698], 0;
// LINE 97:
	__asm        mov    dword ptr ds:[0x66669C], 0;
// LINE 98:
	__asm        mov    dword ptr ds:[0x666690], 0;
// LINE 100:
}

// FUNCTION: COPTER_D 0x004d530f
void VRResFreeBarrys(struct VRResource* res) {
	struct GEOM_Resource* geo;

// LINE 113:
	__asm        mov    eax, res;
	__asm        mov    geo, eax;
// LINE 115:
	__asm        mov    eax, res;
	__asm        cmp    dword ptr [eax+8], 1;
	__asm        je     _T21;
// LINE 116:
	__asm        jmp    _T42;
// LINE 118:
_T21:
	__asm        mov    eax, geo;
	__asm        cmp    dword ptr [eax+0x14], 0;
	__asm        jge    _T33;
// LINE 119:
	__asm        jmp    _T42;
// LINE 121:
_T33:
	__asm        mov    eax, geo;
	__asm        mov    eax, [eax+0x14];
	__asm        push   eax;
	__asm        call   S2AllocFreePool;
	__asm        add    esp, 4;
// LINE 122:
_T42:
}

// FUNCTION: COPTER_D 0x004d5356
struct VRResource* VRLoadResource(char * name, int32_t Flags, void * __ptr32 misc) {
	int32_t i;
	struct VRResource* res;

// LINE 142:
	__asm        mov    eax, Flags;
	__asm        mov    [ebp-0xC], eax;
	__asm        jmp    _T49c;
// LINE 146:
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   GetDir_CMAP;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T2f;
// LINE 147:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 148:
_T2f:
	__asm        mov    i, 0;
	__asm        jmp    _T3e;
_T3b:
	__asm        inc    i;
_T3e:
	__asm        mov    eax, i;
	__asm        cmp    ds:[0x6666A4], eax;
	__asm        jle    _T13b;
// LINE 149:
	__asm        mov    eax, misc;
	__asm        push   eax;
	__asm        mov    eax, i;
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*4];
	__asm        lea    eax, [ecx+eax*4];
	__asm        add    eax, ds:[0x666690];
	__asm        push   eax;
	__asm        call   _stricmp;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T136;
// LINE 151:
	__asm        mov    dword ptr ds:[0x59C220], 1;
// LINE 153:
	__asm        push   0;
	__asm        mov    eax, i;
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*4];
	__asm        lea    eax, [ecx+eax*4];
	__asm        mov    ecx, ds:[0x666690];
	__asm        mov    eax, [eax+ecx+0x11];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _lseek;
	__asm        add    esp, 0xC;
	__asm        cmp    eax, 0xFFFFFFFF;
	__asm        jne    _Tbd;
// LINE 154:
	__asm        mov    dword ptr ds:[0x662810], 3;
// LINE 155:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 157:
_Tbd:
	__asm        push   0x3E8;
	__asm        call   S2AllocPool;
	__asm        add    esp, 4;
	__asm        mov    ds:[0x59C22C], eax;
	__asm        cmp    dword ptr ds:[0x59C22C], 0;
	__asm        jge    _Te3;
// LINE 158:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 159:
_Te3:
	__asm        call   LoadPalette;
	__asm        mov    res, eax;
// LINE 160:
	__asm        cmp    res, 0;
	__asm        jne    _Tfc;
// LINE 161:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 162:
_Tfc:
	__asm        mov    eax, ds:[0x59C22C];
	__asm        mov    ecx, res;
	__asm        mov    [ecx+4], eax;
// LINE 163:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   RegisterResource;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T12e;
// LINE 164:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   VRUnLoadResource;
	__asm        add    esp, 4;
// LINE 165:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 167:
_T12e:
	__asm        mov    eax, res;
	__asm        jmp    _T4ca;
// LINE 169:
_T136:
	__asm        jmp    _T3b;
// LINE 170:
_T13b:
	__asm        mov    dword ptr ds:[0x662810], 7;
// LINE 171:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 172:
	__asm        jmp    _T4c3;
// LINE 176:
	__asm        push   0x10000;
	__asm        call   S2AllocPool;
	__asm        add    esp, 4;
	__asm        mov    ds:[0x59C22C], eax;
	__asm        cmp    dword ptr ds:[0x59C22C], 0;
	__asm        jge    _T177;
// LINE 177:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 178:
_T177:
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   LoadImages;
	__asm        add    esp, 4;
	__asm        mov    res, eax;
// LINE 179:
	__asm        cmp    res, 0;
	__asm        jne    _T197;
// LINE 180:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 181:
_T197:
	__asm        mov    eax, ds:[0x59C22C];
	__asm        mov    ecx, res;
	__asm        mov    [ecx+4], eax;
// LINE 182:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   RegisterResource;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T1c9;
// LINE 183:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   VRUnLoadResource;
	__asm        add    esp, 4;
// LINE 184:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 186:
_T1c9:
	__asm        mov    eax, res;
	__asm        jmp    _T4ca;
// LINE 190:
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   GetDir_GEOM;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T1ec;
// LINE 191:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 193:
_T1ec:
	__asm        mov    i, 0;
	__asm        jmp    _T1fb;
_T1f8:
	__asm        inc    i;
_T1fb:
	__asm        mov    eax, i;
	__asm        cmp    ds:[0x6666B0], eax;
	__asm        jle    _T332;
// LINE 194:
	__asm        mov    eax, misc;
	__asm        push   eax;
	__asm        mov    eax, i;
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*2];
	__asm        lea    eax, [ecx+eax*4];
	__asm        lea    eax, [ecx+eax*4];
	__asm        add    eax, ds:[0x666698];
	__asm        push   eax;
	__asm        call   _stricmp;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T32d;
// LINE 196:
	__asm        mov    dword ptr ds:[0x59C220], 1;
// LINE 198:
	__asm        push   0;
	__asm        mov    eax, i;
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*2];
	__asm        lea    eax, [ecx+eax*4];
	__asm        lea    eax, [ecx+eax*4];
	__asm        mov    ecx, ds:[0x666698];
	__asm        mov    eax, [eax+ecx+0x11];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _lseek;
	__asm        add    esp, 0xC;
	__asm        cmp    eax, 0xFFFFFFFF;
	__asm        jne    _T280;
// LINE 199:
	__asm        mov    dword ptr ds:[0x662810], 3;
// LINE 200:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 202:
_T280:
	__asm        push   0x10000;
	__asm        call   S2AllocPool;
	__asm        add    esp, 4;
	__asm        mov    ds:[0x59C22C], eax;
	__asm        cmp    dword ptr ds:[0x59C22C], 0;
	__asm        jge    _T2a6;
// LINE 203:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 204:
_T2a6:
	__asm        mov    eax, i;
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*2];
	__asm        lea    eax, [ecx+eax*4];
	__asm        lea    eax, [ecx+eax*4];
	__asm        mov    ecx, ds:[0x666698];
	__asm        mov    eax, [eax+ecx+0x15];
	__asm        push   eax;
	__asm        mov    eax, i;
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*2];
	__asm        lea    eax, [ecx+eax*4];
	__asm        lea    eax, [ecx+eax*4];
	__asm        add    eax, ds:[0x666698];
	__asm        add    eax, 0x19;
	__asm        push   eax;
	__asm        call   LoadGroup;
	__asm        add    esp, 8;
	__asm        mov    res, eax;
// LINE 205:
	__asm        cmp    res, 0;
	__asm        jne    _T2f3;
// LINE 206:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 207:
_T2f3:
	__asm        mov    eax, ds:[0x59C22C];
	__asm        mov    ecx, res;
	__asm        mov    [ecx+4], eax;
// LINE 208:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   RegisterResource;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T325;
// LINE 209:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   VRUnLoadResource;
	__asm        add    esp, 4;
// LINE 210:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 212:
_T325:
	__asm        mov    eax, res;
	__asm        jmp    _T4ca;
// LINE 214:
_T32d:
	__asm        jmp    _T1f8;
// LINE 215:
_T332:
	__asm        mov    dword ptr ds:[0x662810], 7;
// LINE 216:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 217:
	__asm        jmp    _T4c3;
// LINE 221:
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   GetDir_GEOM;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T363;
// LINE 222:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 224:
_T363:
	__asm        mov    i, 0;
	__asm        jmp    _T372;
_T36f:
	__asm        inc    i;
_T372:
	__asm        mov    eax, i;
	__asm        cmp    ds:[0x6666B4], eax;
	__asm        jle    _T47a;
// LINE 225:
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*8];
	__asm        mov    ecx, ds:[0x66669C];
	__asm        mov    edx, misc;
	__asm        cmp    [eax+ecx], edx;
	__asm        jne    _T475;
// LINE 227:
	__asm        mov    dword ptr ds:[0x59C220], 1;
// LINE 229:
	__asm        push   0;
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*8];
	__asm        mov    ecx, ds:[0x66669C];
	__asm        mov    eax, [eax+ecx+4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _lseek;
	__asm        add    esp, 0xC;
	__asm        cmp    eax, 0xFFFFFFFF;
	__asm        jne    _T3e4;
// LINE 230:
	__asm        mov    dword ptr ds:[0x662810], 3;
// LINE 231:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 233:
_T3e4:
	__asm        push   0x10000;
	__asm        call   S2AllocPool;
	__asm        add    esp, 4;
	__asm        mov    ds:[0x59C22C], eax;
	__asm        cmp    dword ptr ds:[0x59C22C], 0;
	__asm        jge    _T40a;
// LINE 234:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 235:
_T40a:
	__asm        push   1;
	__asm        mov    eax, i;
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*8];
	__asm        add    eax, ds:[0x66669C];
	__asm        add    eax, 8;
	__asm        push   eax;
	__asm        call   LoadGroup;
	__asm        add    esp, 8;
	__asm        mov    res, eax;
// LINE 236:
	__asm        cmp    res, 0;
	__asm        jne    _T43b;
// LINE 237:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 238:
_T43b:
	__asm        mov    eax, ds:[0x59C22C];
	__asm        mov    ecx, res;
	__asm        mov    [ecx+4], eax;
// LINE 239:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   RegisterResource;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T46d;
// LINE 240:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   VRUnLoadResource;
	__asm        add    esp, 4;
// LINE 241:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 243:
_T46d:
	__asm        mov    eax, res;
	__asm        jmp    _T4ca;
// LINE 245:
_T475:
	__asm        jmp    _T36f;
// LINE 246:
_T47a:
	__asm        mov    dword ptr ds:[0x662810], 8;
// LINE 247:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 248:
	__asm        jmp    _T4c3;
// LINE 253:
_T490:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 255:
	__asm        jmp    _T4c3;
_T49c:
	__asm        dec    dword ptr [ebp-0xC];
	__asm        cmp    dword ptr [ebp-0xC], 3;
	__asm        ja     _T490;

	__asm        mov    eax, [ebp-0xC];
	__asm        jmp    dword ptr [eax*4+0x4D5809];
// Switch pointers
// LINE 256:
_T4c3:
	__asm        xor    eax, eax;
	__asm        jmp    _T4ca;
// LINE 257:
_T4ca:
}

// FUNCTION: COPTER_D 0x004d5825
int32_t VRUnLoadAllResources() {
	struct VRResource* res;

// LINE 278:
_T09:
	__asm        cmp    dword ptr ds:[0x59C224], 0;
	__asm        je     _T3e;
// LINE 279:
	__asm        mov    eax, ds:[0x666500];
	__asm        mov    res, eax;
// LINE 280:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   VRUnLoadResource;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T39;
// LINE 281:
	__asm        xor    eax, eax;
	__asm        jmp    _T48;
// LINE 282:
_T39:
	__asm        jmp    _T09;
// LINE 283:
_T3e:
	__asm        mov    eax, 1;
	__asm        jmp    _T48;
// LINE 284:
_T48:
}

// FUNCTION: COPTER_D 0x004d5872
int32_t VRUnLoadResource(struct VRResource* res) {
	struct GEOM_Resource* geo;

// LINE 305:
	__asm        mov    eax, res;
	__asm        mov    eax, [eax+8];
	__asm        mov    [ebp-8], eax;
	__asm        jmp    _T66;
// LINE 308:
_T17:
	__asm        mov    eax, res;
	__asm        mov    geo, eax;
// LINE 309:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   UnRegisterResource;
	__asm        add    esp, 4;
// LINE 317:
	__asm        jmp    _T89;
// LINE 320:
_T2e:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   UnRegisterResource;
	__asm        add    esp, 4;
// LINE 321:
	__asm        jmp    _T89;
// LINE 324:
_T3f:
	__asm        mov    eax, res;
	__asm        push   eax;
	__asm        call   UnRegisterResource;
	__asm        add    esp, 4;
// LINE 325:
	__asm        jmp    _T89;
// LINE 328:
_T50:
	__asm        mov    dword ptr ds:[0x662810], 0xB;
// LINE 329:
	__asm        xor    eax, eax;
	__asm        jmp    _Taf;
// LINE 331:
	__asm        jmp    _T89;
_T66:
	__asm        cmp    dword ptr [ebp-8], 1;
	__asm        je     _T17;

	__asm        cmp    dword ptr [ebp-8], 3;
	__asm        je     _T2e;

	__asm        cmp    dword ptr [ebp-8], 4;
	__asm        je     _T3f;

	__asm        jmp    _T50;
// LINE 334:
_T89:
	__asm        mov    eax, res;
	__asm        cmp    dword ptr [eax+4], 0;
	__asm        jl     _Ta5;
// LINE 335:
	__asm        mov    eax, res;
	__asm        mov    eax, [eax+4];
	__asm        push   eax;
	__asm        call   S2AllocFreePool;
	__asm        add    esp, 4;
// LINE 337:
_Ta5:
	__asm        mov    eax, 1;
	__asm        jmp    _Taf;
// LINE 338:
_Taf:
}

// FUNCTION: COPTER_D 0x004d5926
int32_t GetDir_GEOM(char * name) {
	struct Chunk chunk;
	int32_t i;

// LINE 364:
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   GetResourceDir;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T24;
// LINE 365:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 369:
_T24:
	__asm        cmp    dword ptr ds:[0x666698], 0;
	__asm        je     _T48;

	__asm        cmp    dword ptr ds:[0x66669C], 0;
	__asm        je     _T48;
// LINE 370:
	__asm        mov    eax, 1;
	__asm        jmp    _T284;
// LINE 375:
_T48:
	__asm        mov    i, 0;
	__asm        jmp    _T57;
_T54:
	__asm        inc    i;
_T57:
	__asm        mov    eax, i;
	__asm        cmp    ds:[0x666694], eax;
	__asm        jle    _T273;
// LINE 377:
	__asm        mov    eax, i;
	__asm        mov    ecx, ds:[0x6663EC];
	__asm        cmp    dword ptr [ecx+eax*8], 0x4D4F4547;
	__asm        jne    _T26e;
// LINE 379:
	__asm        mov    dword ptr ds:[0x59C220], 1;
// LINE 381:
	__asm        push   0;
	__asm        mov    eax, i;
	__asm        mov    ecx, ds:[0x6663EC];
	__asm        mov    eax, [ecx+eax*8+4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _lseek;
	__asm        add    esp, 0xC;
	__asm        cmp    eax, 0xFFFFFFFF;
	__asm        jne    _Tbe;
// LINE 382:
	__asm        mov    dword ptr ds:[0x662810], 3;
// LINE 383:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 386:
_Tbe:
	__asm        push   8;
	__asm        lea    eax, chunk.Id;
	__asm        push   eax;
	__asm        call   ReadResource;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _Tdb;
// LINE 387:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 403:
_Tdb:
	__asm        cmp    chunk.Id, 0x4D4F4547;
	__asm        je     _Tf9;
// LINE 404:
	__asm        mov    dword ptr ds:[0x662810], 6;
// LINE 405:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 408:
_Tf9:
	__asm        push   0x10;
	__asm        push   0x6666B0;
	__asm        call   ReadResource;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T117;
// LINE 409:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 438:
_T117:
	__asm        mov    eax, ds:[0x6666B0];
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*2];
	__asm        lea    eax, [ecx+eax*4];
	__asm        lea    eax, [ecx+eax*4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x59C228];
	__asm        push   eax;
	__asm        call   S2Alloc;
	__asm        add    esp, 8;
	__asm        mov    ds:[0x666698], eax;
// LINE 440:
	__asm        mov    eax, ds:[0x6666B4];
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*8];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x59C228];
	__asm        push   eax;
	__asm        call   S2Alloc;
	__asm        add    esp, 8;
	__asm        mov    ds:[0x66669C], eax;
// LINE 441:
	__asm        cmp    dword ptr ds:[0x666698], 0;
	__asm        jne    _T199;

	__asm        cmp    dword ptr ds:[0x66669C], 0;
	__asm        jne    _T199;
// LINE 442:
	__asm        mov    dword ptr ds:[0x66669C], 0;
// LINE 443:
	__asm        mov    dword ptr ds:[0x666698], 0;
// LINE 444:
	__asm        mov    dword ptr ds:[0x662810], 4;
// LINE 445:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 449:
_T199:
	__asm        mov    dword ptr ds:[0x59C220], 1;
// LINE 451:
	__asm        push   0;
	__asm        mov    eax, ds:[0x6666B8];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _lseek;
	__asm        add    esp, 0xC;
	__asm        cmp    eax, 0xFFFFFFFF;
	__asm        jne    _T1d3;
// LINE 452:
	__asm        mov    dword ptr ds:[0x662810], 3;
// LINE 453:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 456:
_T1d3:
	__asm        mov    eax, ds:[0x6666B0];
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*2];
	__asm        lea    eax, [ecx+eax*4];
	__asm        lea    eax, [ecx+eax*4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x666698];
	__asm        push   eax;
	__asm        call   ReadResource;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T201;
// LINE 457:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 533:
_T201:
	__asm        mov    dword ptr ds:[0x59C220], 1;
// LINE 535:
	__asm        push   0;
	__asm        mov    eax, ds:[0x6666BC];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _lseek;
	__asm        add    esp, 0xC;
	__asm        cmp    eax, 0xFFFFFFFF;
	__asm        jne    _T23b;
// LINE 536:
	__asm        mov    dword ptr ds:[0x662810], 3;
// LINE 537:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 540:
_T23b:
	__asm        mov    eax, ds:[0x6666B4];
	__asm        shl    eax, 2;
	__asm        lea    eax, [eax+eax*8];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x66669C];
	__asm        push   eax;
	__asm        call   ReadResource;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T264;
// LINE 541:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 609:
_T264:
	__asm        mov    eax, 1;
	__asm        jmp    _T284;
// LINE 611:
_T26e:
	__asm        jmp    _T54;
// LINE 612:
_T273:
	__asm        mov    dword ptr ds:[0x662810], 5;
// LINE 613:
	__asm        xor    eax, eax;
	__asm        jmp    _T284;
// LINE 615:
_T284:
}

// FUNCTION: COPTER_D 0x004d5baf
int32_t GetDir_CMAP(char * name) {
	struct Chunk chunk;
	int32_t i;

// LINE 640:
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   GetResourceDir;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T24;
// LINE 641:
	__asm        xor    eax, eax;
	__asm        jmp    _T194;
// LINE 645:
_T24:
	__asm        cmp    dword ptr ds:[0x666690], 0;
	__asm        je     _T3b;
// LINE 646:
	__asm        mov    eax, 1;
	__asm        jmp    _T194;
// LINE 651:
_T3b:
	__asm        mov    i, 0;
	__asm        jmp    _T4a;
_T47:
	__asm        inc    i;
_T4a:
	__asm        mov    eax, i;
	__asm        cmp    ds:[0x666694], eax;
	__asm        jle    _T183;
// LINE 653:
	__asm        mov    eax, i;
	__asm        mov    ecx, ds:[0x6663EC];
	__asm        cmp    dword ptr [ecx+eax*8], 0x50414D43;
	__asm        jne    _T17e;
// LINE 655:
	__asm        mov    dword ptr ds:[0x59C220], 1;
// LINE 657:
	__asm        push   0;
	__asm        mov    eax, i;
	__asm        mov    ecx, ds:[0x6663EC];
	__asm        mov    eax, [ecx+eax*8+4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _lseek;
	__asm        add    esp, 0xC;
	__asm        cmp    eax, 0xFFFFFFFF;
	__asm        jne    _Tb1;
// LINE 658:
	__asm        mov    dword ptr ds:[0x662810], 3;
// LINE 659:
	__asm        xor    eax, eax;
	__asm        jmp    _T194;
// LINE 662:
_Tb1:
	__asm        push   8;
	__asm        lea    eax, chunk.Id;
	__asm        push   eax;
	__asm        call   ReadResource;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _Tce;
// LINE 663:
	__asm        xor    eax, eax;
	__asm        jmp    _T194;
// LINE 678:
_Tce:
	__asm        cmp    chunk.Id, 0x50414D43;
	__asm        je     _Tec;
// LINE 679:
	__asm        mov    dword ptr ds:[0x662810], 6;
// LINE 680:
	__asm        xor    eax, eax;
	__asm        jmp    _T194;
// LINE 683:
_Tec:
	__asm        push   4;
	__asm        push   0x6666A4;
	__asm        call   ReadResource;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T10a;
// LINE 684:
	__asm        xor    eax, eax;
	__asm        jmp    _T194;
// LINE 694:
_T10a:
	__asm        mov    eax, ds:[0x6666A4];
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*4];
	__asm        lea    eax, [ecx+eax*4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x59C228];
	__asm        push   eax;
	__asm        call   S2Alloc;
	__asm        add    esp, 8;
	__asm        mov    ds:[0x666690], eax;
// LINE 695:
	__asm        cmp    dword ptr ds:[0x666690], 0;
	__asm        jne    _T149;
// LINE 696:
	__asm        mov    dword ptr ds:[0x662810], 4;
// LINE 697:
	__asm        xor    eax, eax;
	__asm        jmp    _T194;
// LINE 700:
_T149:
	__asm        mov    eax, ds:[0x6666A4];
	__asm        mov    ecx, eax;
	__asm        lea    eax, [eax+eax*4];
	__asm        lea    eax, [ecx+eax*4];
	__asm        push   eax;
	__asm        mov    eax, ds:[0x666690];
	__asm        push   eax;
	__asm        call   ReadResource;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T174;
// LINE 701:
	__asm        xor    eax, eax;
	__asm        jmp    _T194;
// LINE 726:
_T174:
	__asm        mov    eax, 1;
	__asm        jmp    _T194;
// LINE 728:
_T17e:
	__asm        jmp    _T47;
// LINE 729:
_T183:
	__asm        mov    dword ptr ds:[0x662810], 5;
// LINE 730:
	__asm        xor    eax, eax;
	__asm        jmp    _T194;
// LINE 732:
_T194:
}

// FUNCTION: COPTER_D 0x004d5d48
int32_t GetResourceDir(char * name) {
	struct Chunk chunk;

// LINE 758:
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        push   0x6663F0;
	__asm        call   _stricmp;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T74;
// LINE 759:
	__asm        cmp    dword ptr ds:[0x6663EC], 0;
	__asm        je     _T39;
// LINE 760:
	__asm        mov    eax, 1;
	__asm        jmp    _T134;
// LINE 766:
_T39:
	__asm        mov    dword ptr ds:[0x59C220], 1;
// LINE 768:
	__asm        push   0;
	__asm        push   0;
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _lseek;
	__asm        add    esp, 0xC;
	__asm        cmp    eax, 0xFFFFFFFF;
	__asm        jne    _T6f;
// LINE 769:
	__asm        mov    dword ptr ds:[0x662810], 3;
// LINE 770:
	__asm        xor    eax, eax;
	__asm        jmp    _T134;
// LINE 773:
_T6f:
	__asm        jmp    _T8f;
// LINE 774:
_T74:
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   OpenResourceFile;
	__asm        add    esp, 4;
	__asm        test   eax, eax;
	__asm        jne    _T8f;
// LINE 775:
	__asm        xor    eax, eax;
	__asm        jmp    _T134;
// LINE 783:
_T8f:
	__asm        push   8;
	__asm        lea    eax, chunk.Id;
	__asm        push   eax;
	__asm        call   ReadResource;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _Tac;
// LINE 784:
	__asm        xor    eax, eax;
	__asm        jmp    _T134;
// LINE 801:
_Tac:
	__asm        push   4;
	__asm        push   0x666694;
	__asm        call   ReadResource;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _Tca;
// LINE 802:
	__asm        xor    eax, eax;
	__asm        jmp    _T134;
// LINE 815:
_Tca:
	__asm        mov    eax, ds:[0x666694];
	__asm        shl    eax, 3;
	__asm        push   eax;
	__asm        mov    eax, ds:[0x59C228];
	__asm        push   eax;
	__asm        call   S2Alloc;
	__asm        add    esp, 8;
	__asm        mov    ds:[0x6663EC], eax;
// LINE 816:
	__asm        cmp    dword ptr ds:[0x6663EC], 0;
	__asm        jne    _T104;
// LINE 817:
	__asm        mov    dword ptr ds:[0x662810], 4;
// LINE 818:
	__asm        xor    eax, eax;
	__asm        jmp    _T134;
// LINE 821:
_T104:
	__asm        mov    eax, ds:[0x666694];
	__asm        shl    eax, 3;
	__asm        push   eax;
	__asm        mov    eax, ds:[0x6663EC];
	__asm        push   eax;
	__asm        call   ReadResource;
	__asm        add    esp, 8;
	__asm        test   eax, eax;
	__asm        jne    _T12a;
// LINE 822:
	__asm        xor    eax, eax;
	__asm        jmp    _T134;
// LINE 848:
_T12a:
	__asm        mov    eax, 1;
	__asm        jmp    _T134;
// LINE 849:
_T134:
}

// FUNCTION: COPTER_D 0x004d5e81
int32_t OpenResourceFile(char * name) {
// LINE 872:
	__asm        call   VRCloseResourceFile;
// LINE 873:
	__asm        push   0x8000;
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        call   _open;
	__asm        add    esp, 8;
	__asm        mov    ds:[0x6666A0], eax;
	__asm        cmp    dword ptr ds:[0x6666A0], 0xFFFFFFFF;
	__asm        jne    _T3f;
// LINE 874:
	__asm        mov    dword ptr ds:[0x662810], 1;
// LINE 875:
	__asm        xor    eax, eax;
	__asm        jmp    _T98;
// LINE 878:
_T3f:
	__asm        push   0x7D0;
	__asm        call   S2AllocPool;
	__asm        add    esp, 4;
	__asm        mov    ds:[0x59C228], eax;
	__asm        cmp    dword ptr ds:[0x59C228], 0;
	__asm        jge    _T7d;
// LINE 880:
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _close;
	__asm        add    esp, 4;
// LINE 881:
	__asm        mov    dword ptr ds:[0x662810], 1;
// LINE 882:
	__asm        xor    eax, eax;
	__asm        jmp    _T98;
// LINE 884:
_T7d:
	__asm        mov    eax, name;
	__asm        push   eax;
	__asm        push   0x6663F0;
	__asm        call   strcpy;
	__asm        add    esp, 8;
// LINE 885:
	__asm        mov    eax, 1;
	__asm        jmp    _T98;
// LINE 887:
_T98:
}

// FUNCTION: COPTER_D 0x004d5f1e
int32_t ReadResource(void * __ptr32 buf, int32_t s) {
// LINE 1058:
	__asm        mov    eax, s;
	__asm        push   eax;
	__asm        mov    eax, buf;
	__asm        push   eax;
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _read;
	__asm        add    esp, 0xC;
	__asm        cmp    eax, s;
	__asm        je     _T36;
// LINE 1059:
	__asm        mov    dword ptr ds:[0x662810], 2;
// LINE 1060:
	__asm        xor    eax, eax;
	__asm        jmp    _T40;
// LINE 1062:
_T36:
	__asm        mov    eax, 1;
	__asm        jmp    _T40;
// LINE 1064:
_T40:
}

// FUNCTION: COPTER_D 0x004d5f63
void VRCloseResourceFile() {
// LINE 1092:
	__asm        cmp    dword ptr ds:[0x6666A0], 0;
	__asm        je     _T21;
// LINE 1093:
	__asm        mov    eax, ds:[0x6666A0];
	__asm        push   eax;
	__asm        call   _close;
	__asm        add    esp, 4;
// LINE 1094:
_T21:
	__asm        cmp    dword ptr ds:[0x59C228], 0;
	__asm        jl     _T3c;
// LINE 1096:
	__asm        mov    eax, ds:[0x59C228];
	__asm        push   eax;
	__asm        call   S2AllocFreePool;
	__asm        add    esp, 4;
// LINE 1099:
_T3c:
	__asm        call   InitResource;
// LINE 1100:
}

// FUNCTION: COPTER_D 0x004d5fa9
int32_t RegisterResource(struct VRResource* res) {
// LINE 1119:
	__asm        cmp    dword ptr ds:[0x59C224], 0x64;
	__asm        jl     _T24;
// LINE 1120:
	__asm        mov    dword ptr ds:[0x662810], 0xC;
// LINE 1121:
	__asm        xor    eax, eax;
	__asm        jmp    _T4f;
// LINE 1123:
_T24:
	__asm        mov    eax, ds:[0x59C224];
	__asm        mov    ecx, res;
	__asm        mov    [ecx+0xC], eax;
// LINE 1124:
	__asm        mov    eax, res;
	__asm        mov    ecx, ds:[0x59C224];
	__asm        mov    [ecx*4+0x666500], eax;
	__asm        inc    dword ptr ds:[0x59C224];
// LINE 1125:
	__asm        mov    eax, 1;
	__asm        jmp    _T4f;
// LINE 1127:
_T4f:
}

// FUNCTION: COPTER_D 0x004d5ffd
void UnRegisterResource(struct VRResource* res) {
	int32_t i;
	struct VRResource* r;

// LINE 1146:
	__asm        mov    eax, res;
	__asm        mov    eax, [eax+0xC];
	__asm        mov    i, eax;
// LINE 1147:
	__asm        mov    eax, i;
	__asm        mov    ecx, res;
	__asm        cmp    [eax*4+0x666500], ecx;
	__asm        je     _T2a;
// LINE 1148:
	__asm        jmp    _T5c;
// LINE 1149:
_T2a:
	__asm        dec    dword ptr ds:[0x59C224];
// LINE 1150:
	__asm        mov    eax, ds:[0x59C224];
	__asm        mov    eax, [eax*4+0x666500];
	__asm        mov    ecx, i;
	__asm        mov    [ecx*4+0x666500], eax;
	__asm        mov    eax, i;
	__asm        mov    eax, [eax*4+0x666500];
	__asm        mov    r, eax;
// LINE 1151:
	__asm        mov    eax, i;
	__asm        mov    ecx, r;
	__asm        mov    [ecx+0xC], eax;
// LINE 1153:
_T5c:
}



// Contribution: 3:00005220-00005230 Module: 146, 4 byte alignment, initialized_data, read, write, 
// GLOBAL: COPTER_D 0x0059c220
// bufferBad
// GLOBAL: COPTER_D 0x0059c224
// NextResource
// GLOBAL: COPTER_D 0x0059c228
// ResFileMemPool
// GLOBAL: COPTER_D 0x0059c22c
// G_currmempool


// Unknown globals:
// The PDB was slightly corrupted and we aren't sure which file these globals belong to.
// GLOBAL: COPTER_D 0x006666b0
// _GEOM_hdr
// GLOBAL: COPTER_D 0x006666a4
// _CMAP_hdr
// GLOBAL: COPTER_D 0x006666a0
// _ResourceFilePtr
// GLOBAL: COPTER_D 0x0066669c
// _GEOM_IDdir
// GLOBAL: COPTER_D 0x00666698
// _GEOM_GPdir
// GLOBAL: COPTER_D 0x00666694
// _ResourceDirHdr
// GLOBAL: COPTER_D 0x00666690
// _CMAP_directory
// GLOBAL: COPTER_D 0x00666500
// _ResourceArray
// GLOBAL: COPTER_D 0x006663f0
// _ResourceFileName
// GLOBAL: COPTER_D 0x006663ec
// _ResourceDir
// GLOBAL: COPTER_D 0x006663f0
// ResourceFileName
// GLOBAL: COPTER_D 0x006663ec
// ResourceDir
// GLOBAL: COPTER_D 0x006666a0
// ResourceFilePtr
// GLOBAL: COPTER_D 0x00666694
// ResourceDirHdr
// GLOBAL: COPTER_D 0x00666500
// ResourceArray
